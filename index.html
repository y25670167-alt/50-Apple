<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>å’Œmjä¸€èµ·åƒè‹¹æœ</title>
<meta name="description" content="å°‘å¥³å¿ƒç²‰ç™½ Â· ä¸Šä¼ mjç…§ç‰‡ Â· 50é¢˜O3 Â· é«˜çº§æ’ç‰ˆå®Œæ•´ç‰ˆ"/>
<style>
/* --- 1. è§†è§‰åŸºè°ƒï¼šä½é¥±å’Œ + æ¥·ä½“ --- */
:root {
  --bg1: #fcfaf7;      /* ææµ…æä»ç™½ */
  --bg2: #fff5f7;      /* ææµ…ç»¯çº¢ */
  --card: #ffffff;     /* å¡ç‰‡ç™½ */
  --ink: #594a4e;      /* ä¼˜é›…è¤ç° */
  --muted: #9e8c92;    /* è¾…åŠ©ç°ç´« */
  --acc: #d47a96;      /* è«å…°è¿ªå¹²æ¯ç«ç‘°ç²‰ */
  --acc-light: #fbeef3;/* æµ…ç²‰è¡¬åº• */
  --line: #f0e4e8;     /* æŸ”å’Œåˆ†å‰²çº¿ */
  --shadow: 0 8px 24px -6px rgba(212, 122, 150, 0.15);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; }

body {
  margin: 0;
  color: var(--ink);
  font-family: "KaiTi", "STKaiti", "æ¥·ä½“", "Songti SC", serif; /* å¼ºåˆ¶æ¥·ä½“ */
  background: linear-gradient(160deg, var(--bg1) 0%, var(--bg2) 100%);
  background-attachment: fixed;
  font-size: 16px;
}

/* æ°›å›´èƒŒæ™¯è£…é¥° */
body::before {
  content: ""; position: fixed; top: -10%; right: -10%; width: 600px; height: 600px;
  background: radial-gradient(circle, #ffeef2 0%, #fff0 70%); z-index: -1; opacity: 0.7;
}

.wrap { max-width: 800px; margin: auto; padding: 20px 18px; }

/* å¤´éƒ¨ */
header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
.brand { display: flex; gap: 12px; align-items: center; }
.mjThumb { 
  width: 50px; height: 50px; border-radius: 50%; 
  border: 2px solid #fff; object-fit: cover; background: #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}
h1 { margin: 0; font-size: 20px; font-weight: bold; letter-spacing: 1px; color: var(--ink); }

/* é€šç”¨å¡ç‰‡ */
.card {
  background: var(--card); border: 1px solid var(--line);
  border-radius: 16px; padding: 24px;
  box-shadow: var(--shadow); margin-bottom: 20px;
  position: relative; overflow: hidden;
}

/* è¾“å…¥æ¡† */
label { display: block; font-size: 14px; color: var(--muted); margin-bottom: 8px; font-weight: bold; }
input[type=text] {
  width: 100%; padding: 14px; border-radius: 10px;
  border: 1px solid var(--line); background: #fdfdfd;
  color: var(--ink); font-family: inherit; font-size: 16px;
  transition: .2s; outline: none;
}
input[type=text]:focus { border-color: var(--acc); background: #fff; }

/* æŒ‰é’® */
.btn {
  padding: 12px 20px; border-radius: 50px;
  border: 1px solid var(--line); background: #fff; color: var(--ink);
  cursor: pointer; transition: all .2s;
  font-family: inherit; font-size: 15px; letter-spacing: 1px;
}
.btn:active { transform: scale(0.97); }
.btn.primary {
  background: var(--acc); color: #fff; border-color: var(--acc);
  box-shadow: 0 4px 15px rgba(212, 122, 150, 0.25);
}
.btn.disabled { opacity: 0.5; pointer-events: none; }
.btn.ghost { background: transparent; border: none; color: var(--muted); padding: 6px 12px; }

/* é¢˜ç›®åŒº */
.progress { height: 4px; background: var(--acc-light); border-radius: 99px; margin: 12px 0 24px; overflow: hidden; }
.progress > div { 
  height: 100%; background: var(--acc); width: 0%; 
  transition: width 0.3s ease-out; 
}
.anim-box { animation: none; }
.anim-box.in { animation: slideUpFade 0.35s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
@keyframes slideUpFade {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.qPanel { display: flex; gap: 20px; align-items: flex-start; }
.qLeft { flex: 1; }
.qRight { width: 90px; flex-shrink: 0; text-align: center; }
.qRight .mjThumb { width: 80px; height: 80px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

@media (max-width: 600px) {
  .qPanel { flex-direction: column-reverse; gap: 16px; }
  .qRight { width: 100%; display: flex; align-items: center; gap: 12px; background: var(--acc-light); padding: 10px 14px; border-radius: 10px; }
  .qRight .mjThumb { width: 40px; height: 40px; border-radius: 50%; }
  .q { font-size: 18px; }
}

.q { font-weight: bold; margin-bottom: 20px; font-size: 20px; line-height: 1.5; color: var(--ink); }
.opt { display: grid; grid-template-columns: 1fr; gap: 12px; }
.opt button {
  text-align: left; background: #fff; padding: 16px 20px;
  border-radius: 12px; border: 1px solid var(--line);
  font-family: inherit; font-size: 16px; color: var(--ink);
  transition: background .2s, border .2s;
}
.opt button:active { background: #fafafa; }
.opt button.sel {
  border-color: var(--acc); background: var(--acc-light); color: #c46885; font-weight: bold;
}

/* --- ç»“æœé¡µé«˜çº§æ’ç‰ˆ --- */
.res-header { text-align: center; border-bottom: 1px dashed var(--line); padding-bottom: 16px; margin-bottom: 20px; }
.res-title { font-size: 24px; font-weight: bold; color: var(--acc); margin-bottom: 8px; }
.res-meta { font-size: 13px; color: var(--muted); }

/* èƒ½é‡æ¡å›¾è¡¨ */
.chart-box { margin-bottom: 24px; padding: 16px; background: #fffbf5; border-radius: 10px; border: 1px solid #f2ece0; }
.chart-row { display: flex; align-items: center; margin-bottom: 8px; font-size: 13px; }
.chart-row:last-child { margin-bottom: 0; }
.chart-label { width: 80px; flex-shrink: 0; color: var(--ink); }
.chart-bar-bg { flex: 1; height: 6px; background: #eee; border-radius: 4px; overflow: hidden; margin: 0 10px; }
.chart-bar-fill { height: 100%; background: var(--acc); border-radius: 4px; }
.chart-val { width: 30px; text-align: right; color: var(--muted); font-family: monospace; }

/* æ–‡æœ¬å— */
.block-title { font-size: 14px; color: var(--muted); margin: 20px 0 8px; display: flex; align-items: center; gap: 6px; }
.block-title::before { content: ""; display: block; width: 4px; height: 14px; background: var(--acc); border-radius: 2px; }

.res-body { font-size: 16px; line-height: 1.8; text-align: justify; color: #5e4b53; }

/* è€³è¯­æ¡† */
.whisper-box {
  margin: 16px 0; padding: 16px 20px;
  background: var(--acc-light); 
  border-left: 3px solid var(--acc);
  border-radius: 0 8px 8px 0;
  color: #9e5e74; font-style: italic; font-size: 15px;
}

/* è®°å¿†åˆ‡ç‰‡ */
.scene-card {
  background: #fff; border: 1px solid var(--line);
  padding: 18px; border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.03);
  margin-top: 10px;
  font-family: "KaiTi";
}

/* æç¤ºå¼¹çª— */
.toast-mask {
  position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 200;
  display: none; align-items: center; justify-content: center;
}
.toast-box {
  background: #fff; padding: 24px; border-radius: 16px; width: 80%; max-width: 320px; text-align: center;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}

canvas { display: none; }
</style>
</head>
<body>

<div class="wrap">
  <header>
    <div class="brand">
      <img id="mjThumbTop" class="mjThumb" alt="mj"/>
      <div>
        <h1 style="font-weight:bold">å’Œmjä¸€èµ·åƒè‹¹æœ</h1>
        <div class="hint" style="font-size:12px;margin:0">è·³è½¬åœ¨å³ä¸Šè§’ç´¢å¼•</div>
      </div>
    </div>
    <nav>
      <button class="btn ghost" id="openIndex">ç´¢å¼•</button>
      <button class="btn ghost" id="resetAll">é‡ç½®</button>
    </nav>
  </header>

  <div class="card" id="setup">
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin-bottom:16px;">
      <div>
        <label>Ta çš„ç§°å‘¼</label>
        <input id="titleInput" type="text" placeholder="ä¾‹ï¼šå­¦é•¿ / å…ˆç”Ÿ"/>
      </div>
      <div>
        <label>Ta çš„åå­—</label>
        <input id="nameInput" type="text" placeholder="ä¾‹ï¼šé˜¿æŸ"/>
      </div>
    </div>
    <div style="margin-bottom:24px;">
      <label>ä¸Šä¼ ç…§ç‰‡ï¼ˆç”¨äºç”Ÿæˆæµ·æŠ¥ï¼‰</label>
      <div style="position:relative; margin-top:8px;">
         <button class="btn" style="width:100%; border-style:dashed; color:var(--muted)">+ ç‚¹å‡»é€‰æ‹©ç›¸å†Œç…§ç‰‡</button>
         <input id="photoInput" type="file" accept="image/*" style="position:absolute; inset:0; opacity:0; cursor:pointer;"/>
      </div>
    </div>
    <button class="btn primary" id="startBtn" style="width:100%; font-size:17px; padding:14px;">å¼€å§‹æµ‹è¯•</button>
  </div>

  <div class="card" id="quizBox" style="display:none">
    <div style="display:flex; justify-content:space-between; color:var(--muted); font-size:12px;">
      <span id="qCounter">1 / 50</span>
      <span>Progress</span>
    </div>
    <div class="progress"><div id="bar"></div></div>
    
    <div class="anim-box" id="animBox">
      <div class="qPanel">
        <div class="qLeft">
          <div class="q" id="qText">é¢˜ç›®åŠ è½½ä¸­...</div>
          <div class="opt" id="optBox"></div>
        </div>
        <div class="qRight">
          <img id="mjThumbSide" class="mjThumb" alt="mj"/>
          <div class="hint" style="font-size:12px; margin-top:4px">Your MJ</div>
        </div>
      </div>
    </div>

    <div style="display:flex; justify-content:space-between; margin-top:24px;">
      <button class="btn" id="prevBtn" style="padding:10px 24px">ä¸Šä¸€é¢˜</button>
      <button class="btn primary disabled" id="nextBtn" style="padding:10px 24px">ä¸‹ä¸€é¢˜</button>
    </div>
  </div>

  <div class="card" id="resultBox" style="display:none">
    <div class="res-header">
      <div class="res-title" id="resTitle"></div>
      <div class="res-meta" id="resMeta"></div>
    </div>

    <div class="chart-box" id="resChart"></div>

    <div class="block-title">æ ¸å¿ƒè§£è¯»</div>
    <div class="res-body" id="resBase"></div>

    <div class="whisper-box" id="resWhisper"></div>

    <div class="block-title">æ··åˆæˆåˆ†</div>
    <div class="res-body" id="resBlend"></div>

    <div class="block-title">ç‹¬å®¶è®°å¿†åˆ‡ç‰‡</div>
    <div class="scene-card" id="resScene"></div>

    <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:30px; border-top:1px solid var(--line); padding-top:24px;">
      <button class="btn primary" id="savePoster" style="flex:1; width:100%">ç”Ÿæˆæµ·æŠ¥ (PNG)</button>
      <div style="width:100%; display:flex; gap:12px">
        <button class="btn" id="copyText" style="flex:1">å¤åˆ¶æ–‡å­—</button>
        <button class="btn" id="redoBtn" style="flex:1">é‡åš</button>
      </div>
    </div>
    <canvas id="poster" width="900" height="1600"></canvas>
  </div>

  <div style="text-align:center; font-size:12px; color:var(--muted); margin-top:30px; opacity:0.6;">
    Â© ç²‰ç²‰åƒè‹¹æœç ”ç©¶æ‰€ Â· O3 è‡»äº«ç‰ˆ
  </div>
</div>

<div class="toast-mask" id="indexMask" style="backdrop-filter: blur(4px);">
  <div class="toast-box" style="width:90%; max-width:600px; text-align:left;">
    <div style="display:flex;justify-content:space-between;margin-bottom:12px">
      <strong>é¢˜ç›®ç´¢å¼•</strong>
      <button class="btn ghost" id="closeIndex" style="padding:0">âœ•</button>
    </div>
    <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap:8px; max-height:50vh; overflow-y:auto;" id="indexGrid"></div>
  </div>
</div>

<div class="toast-mask" id="posterToast">
  <div class="toast-box">
    <div style="font-size:24px; margin-bottom:10px;">âœ…</div>
    <strong style="font-size:18px;">æµ·æŠ¥å·²ç”Ÿæˆ</strong>
    <p style="margin:12px 0; font-size:14px; color:var(--ink); line-height:1.6;">
      å¦‚æœæµè§ˆå™¨æ‹¦æˆªäº†è‡ªåŠ¨ä¸‹è½½ï¼Œ<br>è¯·é•¿æŒ‰å›¾ç‰‡ä¿å­˜ï¼Œæˆ–ç›´æ¥æˆªå›¾ã€‚
    </p>
    <button class="btn primary" onclick="document.getElementById('posterToast').style.display='none'">å¥½çš„ï¼Œæˆ‘çŸ¥é“äº†</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {

/*** æ•°æ®ä¸æ–‡æ¡ˆé…ç½® ***/
const TYPES = ["GENTLE","DOM","FERAL","TEASE","STOIC","LOYAL"];
const TITLES = {
  GENTLE: "æ¸©åæººçˆ±å‹", 
  DOM:    "ç»å¯¹æŒæ§å‹", 
  FERAL:  "åŸå§‹æ å¤ºå‹", 
  TEASE:  "æ¶åŠ£é’“ç³»å‹", 
  STOIC:  "éšå¿ç ´æˆ’å‹", 
  LOYAL:  "åæ‰§ç‹¬å å‹"  
};
const TAGS = {
  GENTLE: ["ç»µå¯†å“å°", "æŒå¿ƒæ‰˜æ§", "æººçˆ±å¼åå’½"],
  DOM: ["æŒ‡å°–å®¡è§†", "å‰¥çš®æ‹†éª¨", "ç»å¯¹æŒæ§"],
  FERAL: ["æ±æ°´å››æº¢", "é½¿ç—•é‚£ç§ç—›", "æ å¤ºæœ¬èƒ½"],
  TEASE: ["ç ”ç£¨æœçš®", "åå¿ƒçœ¼è¯•æ¢", "æ‚¬å´–è¾¹åœé¡¿"],
  STOIC: ["æåº¦å…‹åˆ¶", "å†·é™ç–¯æ„Ÿ", "ç²¾å¯†è§£æ„"],
  LOYAL: ["æŠ¤é£Ÿæœ¬èƒ½", "è™”è¯šçƒ™å°", "ç‹¬å æ¬²"]
};

// è¿™é‡Œçš„ DESC åšäº†æ•°æ®ç»“æ„æ‹†åˆ†ï¼Œæ–¹ä¾¿æ’ç‰ˆ
const DESC_DATA = {
  GENTLE: {
    text: "ä¸å…¶è¯´è¿™æ˜¯ä¸€æ¬¡ç®€å•çš„è¿›é£Ÿï¼Œä¸å¦‚è¯´æ˜¯ä¸€åœºç»è¿‡ç²¾å¯†è®¡ç®—ã€æ—¨åœ¨è®©ä½ åœ¨é«˜æ¸©ä¸­ç¼“æ…¢æººäº¡çš„æ¸©æŸ”é™·é˜±ã€‚Taå¹¶ä¸æ€¥ç€å°†ä½ æ‹†åƒå…¥è…¹ï¼Œè€Œæ˜¯å°†è¿™é¢—è‹¹æœè§†ä¸ºä¸–é—´ä»…å­˜ã€ç¨ç¢°å³ç¢çš„å­¤æœ¬ã€‚æŒ‡è…¹æ²¿ç€æœçš®çš„çº¹ç†æš§æ˜§æ¸¸èµ°ï¼ŒæŒ‡å°–çš„æ¸©åº¦é€è¿‡è–„è–„çš„æœçš®ä¼ é€’ï¼Œåƒæ˜¯åœ¨ç¡®è®¤å“ªé‡Œæœ€ç”œã€å“ªé‡Œæœ€è½¯ï¼Œåˆåƒæ˜¯åœ¨éš”ç€è¡£æ–™æŠšæ‘¸ä½ å› ç´§å¼ è€Œé¢¤æ —çš„è„ŠèƒŒã€‚\n\né‚£ç§æ¸©åçš„ã€ä¸å®¹æ‹’ç»çš„æŸ”å’Œï¼Œåƒæµæ·Œçš„æ¸©çƒ­ç³–æµ†ï¼Œä¸€ç‚¹ç‚¹å°ä½ä½ çš„æ„Ÿå®˜ã€‚ç©ºæ°”é‡Œå¼¥æ¼«ç€ä¸€è‚¡ç”œè…»åˆ°è®©äººå‘æ˜çš„æ°”æ¯ï¼ŒTaä¼šç‰¹æ„é¿å¼€é‚£äº›å¯èƒ½å¼„ç–¼ä½ çš„ç²—æš´å•ƒå’¬ï¼Œåªç”¨å”‡é½¿æ¸©æŸ”åœ°ç ”ç£¨ï¼Œç”šè‡³åœ¨æ±æ°´ä¸å°å¿ƒæº¢å‡ºæ²¾æ¹¿ä½ çš„å˜´è§’æ—¶ï¼Œè¿˜è¦åœä¸‹æ¥ï¼Œç”¨å¾®å‡‰çš„æŒ‡è…¹æ›¿ä½ ä¸€ç‚¹ç‚¹æ“¦æ‹­å¹²å‡€ï¼ŒåŠ¨ä½œç»†è‡´å¾—è®©ä½ è§‰å¾—ç¾è€»ï¼Œä»¿ä½›ä½ æ˜¯ä¸€ä¸ªç”Ÿæ´»ä¸èƒ½è‡ªç†ã€åªèƒ½ä¾é™„äºTaçš„ç“·å¨ƒå¨ƒã€‚\n\nè¿™ç§â€œè¿‡åº¦å‘µæŠ¤â€åƒæ¸©æ°´ç…®é’è›™èˆ¬æŠŠä½ çš„ç†æ™ºä¸€ç‚¹ç‚¹è’¸å‘ã€‚å“ªæ€•ä½ å·²ç»éš¾è€åœ°æƒ³è¦å‚¬ä¿ƒï¼Œç”šè‡³å› ä¸ºè¿‡ä¹…çš„ç­‰å¾…è€Œçœ¼è§’æ³›çº¢ï¼ŒTaä¹Ÿä¸æ€¥ç€åå’½ï¼Œè€Œæ˜¯å…ˆç”¨å”‡èˆŒä¸€ç‚¹ç‚¹å·èµ°ä½ å˜´è§’çš„ç”œï¼Œè€å¿ƒåœ°ç­‰ä½ å½»åº•åŒ–å¼€ã€‚Taä¼šä¸€è¾¹è§‚å¯Ÿä½ çš„è¡¨æƒ…ï¼Œä¸€è¾¹åœ¨ä½ è€³è¾¹ä½å£°è¯¢é—®ä½ çš„æ„Ÿå—ï¼Œç›´åˆ°ç¡®è®¤ä½ å·²ç»å®Œå…¨å¤±å»äº†åæŠ—çš„èƒ½åŠ›ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ çš„èŠ‚å¥è¢«å®Œå…¨å‰¥å¤ºï¼Œåªèƒ½åœ¨Taç¼–ç»‡çš„ç”œèœœç¼ºæ°§æ„Ÿä¸­ï¼Œè½¯æˆä¸€æ»©æ°´ï¼Œä»»ç”±Taäºˆå–äºˆæ±‚ï¼Œè¿å‘¼å¸çš„é¢‘ç‡éƒ½å¿…é¡»è·ŸéšTaçš„å¼•å¯¼ã€‚",
    whisper: "ä¹–â€¦â€¦æ€ä¹ˆæŠ–å¾—è¿™ä¹ˆå‰å®³â€¦â€¦å˜˜ï¼Œåˆ«å’¬å˜´å”‡ï¼Œå¼ å¼€â€¦â€¦è®©æˆ‘å°å°æ˜¯ä¸æ˜¯å’Œæƒ³è±¡çš„ä¸€æ ·ç”œâ€¦â€¦å†åŒ–å¼€ä¸€ç‚¹â€¦â€¦å…¨éƒ½ç»™æˆ‘å¥½ä¸å¥½â€¦â€¦"
  },
  DOM: {
    text: "è¿™æ˜¯ä¸€åœºç»å¯¹çš„ä¸Šä½è€…å®¡è§†ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡å…³äºâ€œæœä»ä¸æƒ©ç½šâ€çš„é©¯åŒ–è¯¾ç¨‹ã€‚åœ¨è¿™ä¸ªå°é—­çš„ç©ºé—´é‡Œï¼ŒTaå°±æ˜¯å”¯ä¸€çš„æ³•åˆ™ã€‚Taæ ¹æœ¬ä¸æ€¥ç€ä¸‹å£ï¼Œè€Œæ˜¯ä¹ æƒ¯å…ˆç”¨å†°å‡‰çš„æŒ‡å°–æŒ‘èµ·ä½ çš„ä¸‹å·´ï¼Œå¼ºè¿«ä½ æŠ¬èµ·å¤´ï¼Œç”¨é‚£ç§æå…·ç©¿é€åŠ›çš„ç›®å…‰æŠŠä½ ä»é‡Œåˆ°å¤–å‰¥ç¦»å¹²å‡€ï¼Œä»¿ä½›ä½ æ‰€æœ‰çš„ç§˜å¯†ã€æ‰€æœ‰éšç§˜çš„æ¸´æœ›åœ¨Taé¢å‰éƒ½æ— æ‰€éå½¢ã€‚è¿™é¢—è‹¹æœåœ¨Taæ‰‹é‡Œæ— å¤„å¯é€ƒï¼Œæ¯ä¸€æ¬¡é½¿å…³çš„å’¬åˆéƒ½æ˜¯åœ¨å®£èª“ä¸»æƒï¼Œé‚£ç§å¸¦ç€æƒ©ç½šæ€§è´¨çš„åŠ›åº¦ï¼Œç²¾å‡†åœ°å¡åœ¨è®©ä½ æ„Ÿåˆ°å±é™©å´åˆä¸æ•¢é€ƒç¦»çš„ä¸´ç•Œçº¿ä¸Šã€‚\n\nTaæå…¶äº«å—æŒæ§è¿›é£Ÿçš„æ·±æµ…ä¸é¢‘ç‡ï¼Œç”šè‡³ä¼šæ•…æ„åœä¸‹æ¥ï¼Œé¢æ— è¡¨æƒ…åœ°æ¬£èµä½ å› ä¸ºæ…Œä¹±è€Œæ€¥ä¿ƒçš„å‘¼å¸ï¼Œçœ‹ç€ä½ åœ¨Taçš„æ³¨è§†ä¸‹ç‘Ÿç‘Ÿå‘æŠ–å´åˆä¸æ•¢ç§»å¼€è§†çº¿çš„æ ·å­ã€‚å¦‚æœä½ è¯•å›¾èº²é¿ï¼Œæˆ–è€…æ˜¯å‘å‡ºä¸€ç‚¹ç‚¹ä¸å—æ§çš„ã€Taæ²¡å…è®¸çš„å£°éŸ³ï¼Œéƒ½ä¼šæ¢æ¥Taæ›´å¼ºåŠ¿çš„é•‡å‹â€”â€”æˆ–è®¸æ˜¯çªç„¶æ”¶ç´§çš„æ‰‹æŒ‡ï¼Œæˆ–è®¸æ˜¯æ›´åŠ æ·±å…¥çš„æ å¤ºã€‚æ•´ä¸ªç©ºé—´é‡Œï¼Œç©ºæ°”ç¨€è–„å¾—è®©äººçª’æ¯ï¼Œè€³è¾¹åªå‰©ä¸‹TaæŒæ§ä¸€åˆ‡çš„å‘¼å¸å£°ï¼Œå’Œé‚£ç§â€œæˆ‘ä¸è®¸ä½ é€ƒâ€çš„å¼ºå¤§å‹è¿«æ„Ÿã€‚åœ¨è¿™ç§æç«¯çš„å¼ åŠ›ä¸‹ï¼Œä½ çš„å¤§è„‘ä¸€ç‰‡ç©ºç™½ï¼Œç¾è€»æ„Ÿè¢«å¿«æ„Ÿå–ä»£ï¼Œä½ åªéœ€è¦äº¤å‡ºæ€è€ƒçš„èƒ½åŠ›ï¼ŒåšTaæŒå¿ƒé‡Œæœ€å¬è¯ã€æœ€å®Œç¾çš„çŒç‰©ï¼Œç­‰å¾…ç€Taç»™äºˆçš„æœ€åå®¡åˆ¤ã€‚",
    whisper: "çœ¼ç›çœ‹ç€æˆ‘â€¦â€¦èº²ä»€ä¹ˆâ€¦â€¦è¿™é‡Œâ€¦â€¦è¿˜æœ‰è¿™é‡Œâ€¦â€¦å…¨æ˜¯æˆ‘ç•™ä¸‹çš„å°è®°â€¦â€¦ä½ å“ªå„¿ä¹Ÿå»ä¸äº†â€¦â€¦"
  },
  FERAL: {
    text: "é¥¥é¥¿äº†å‡ ä¸ªä¸–çºªçš„é‡å…½ç»ˆäºåœ¨è¿™ä¸€åˆ»å½»åº•æ’•å¼€äº†å¹³æ—¥é‡Œæ–¯æ–‡å¾—ä½“çš„ä¼ªè£…ï¼Œéœ²å‡ºäº†æœ€åŸæœ¬ã€æœ€è´ªå©ªã€ä¹Ÿæœ€ä»¤äººèƒ†å¯’çš„ç ç‰™ã€‚å¹³æ—¥é‡Œé‚£äº›æ¸©æ–‡å°”é›…çš„å‡è±¡ç¢äº†ä¸€åœ°ï¼Œæ­¤æ—¶æ­¤åˆ»ï¼ŒTaçœ‹ç€ä½ çš„çœ¼ç¥ä¸å†æ˜¯åœ¨çœ‹ä¸€ä¸ªçˆ±äººï¼Œè€Œæ˜¯åœ¨çœ‹å”¯ä¸€çš„ã€å¿…é¡»ç«‹åˆ»æ‹†åƒå…¥è…¹çš„çŒç‰©ã€‚æ²¡æœ‰ä»»ä½•å¤šä½™çš„ã€æ¸©æƒ…çš„ç¼“å†²å‰æˆï¼Œä¹Ÿæ²¡æœ‰é‚£äº›èŠ±é‡Œèƒ¡å“¨çš„è°ƒæƒ…æŠ€å·§ï¼Œè¿™é‡Œåªå‰©ä¸‹æœ€åŸå§‹ã€æœ€ç²—æš´çš„æ å¤ºæœ¬èƒ½ã€‚\n\né½¿å°–åˆ‡å…¥æœè‚‰çš„å£°éŸ³åœ¨å°é—­çš„ç©ºé—´é‡Œæ¸…æ™°å¾—è®©äººå¤´çš®å‘éº»ï¼Œç”šè‡³èƒ½å¬åˆ°æ±æ°´é£æº…çš„ç»†å¾®å£°å“ï¼Œé‚£æ˜¯æŠŠä½ è¿çš®å¸¦éª¨æ‹†åƒå…¥è…¹çš„æ€¥åˆ‡ã€‚Taçš„åŠ¨ä½œç²—é²ä¸­å¤¹æ‚ç€è®©è‚¾ä¸Šè…ºç´ ç¬é—´é£™å‡çš„ç—›æ„Ÿï¼Œæ¯”èµ·æ‰€è°“çš„â€œå“å°â€ï¼ŒTaæ›´åƒæ˜¯åœ¨è¿›è¡Œä¸€åœºä¸æ­»ä¸ä¼‘çš„ç‹©çŒã€‚æ¯ä¸€æ¬¡è§¦ç¢°éƒ½å¸¦ç€è¦æŠŠä½ æ‰ç¢çš„åŠ›åº¦ï¼Œæ¯ä¸€æ¬¡å‘¼å¸éƒ½åƒæ˜¯ä¸‹ä¸€ç§’ä¸–ç•Œæœ«æ—¥å°±è¦æ¥ä¸´ï¼Œè€Œä½ æ˜¯Taåœ¨è¿™ä¸ªå´©åä¸–ç•Œé‡Œå”¯ä¸€çš„æ•‘èµå’Œé£Ÿç²®ã€‚\n\nTaæ ¹æœ¬ä¸ä¼šé¡¾åŠä½ ä¼šä¸ä¼šå¼„è„è¡£æœï¼Œä¹Ÿä¸ä¼šåœ¨ä¹å§¿åŠ¿æ˜¯å¦ç‹¼ç‹ˆï¼ŒTaåªæƒ³æŠŠè¿™é¢—è‹¹æœæ‰ç¢ï¼ŒæŠŠæº¢å‡ºæ¥çš„æ‰€æœ‰æ±æ°´å…¨éƒ¨åå’½ä¸‹å»ã€‚é‚£ç§æ²‰é‡è€Œæ»šçƒ«çš„å‘¼å¸å£°ç‹ ç‹ æ‰“åœ¨ä½ çš„é¢ˆä¾§ï¼Œå¸¦ç€å‡ ä¹èƒ½çƒ«ä¼¤çš®è‚¤çš„çƒ­åº¦ï¼Œè®©ä½ äº§ç”Ÿä¸€ç§éšæ—¶ä¼šè¢«TaçœŸçš„ååƒå…¥è…¹çš„é”™è§‰ã€‚ç©ºæ°”é‡Œå¼¥æ¼«ç€å±é™©çš„é“é”ˆå‘³å’ŒTaèº«ä¸Šæå…·ä¾µç•¥æ€§çš„æ°”æ¯ï¼Œè¿™ç§æ¿’æ­»çš„å±æœºæ„Ÿæ··åˆç€æåº¦çš„åˆºæ¿€ï¼Œè®©ä½ å¤§è„‘ä¸€ç‰‡ç©ºç™½ï¼Œä¸å¾—ä¸æœ¬èƒ½åœ°ç´§ç´§æ”€é™„ç€Taã€‚Taä¸ä»…è¦å æœ‰è¿™é¢—è‹¹æœï¼Œè¿˜è¦åœ¨ä¸Šé¢ç•™ä¸‹æ°¸è¿œæ— æ³•æ¶ˆé€€çš„é½¿ç—•å’Œæ°”å‘³ï¼Œè¦è®©é‚£äº›å°è®°æ·±æ·±åˆ»å…¥ä½ çš„éª¨è¡€ï¼Œè®©ä½ å…¨èº«ä¸Šä¸‹éƒ½æŸ“ä¸ŠTaçš„æ ‡è®°ã€‚é™¤äº†Taæ€€é‡Œï¼Œä½ å“ªé‡Œä¹Ÿå»ä¸äº†ã€‚",
    whisper: "å“ˆâ€¦â€¦å¤ªç”œäº†â€¦â€¦æ€ä¹ˆåƒéƒ½ä¸å¤Ÿâ€¦â€¦æƒ³æŠŠä½ æ‰ç¢äº†åä¸‹å»â€¦â€¦åˆ«åŠ¨â€¦â€¦"
  },
  TEASE: {
    text: "æ¶åŠ£è‡³æçš„é«˜æ˜çŒæ‰‹ï¼Œæœ€æ“…é•¿æŠŠäººå¿ƒç©å¼„äºè‚¡æŒä¹‹é—´ã€‚Taå°±åƒä¸€åªç‹¡çŒ¾çš„ç‹ç‹¸ï¼Œæœ€å–œæ¬¢åœ¨ç†æ™ºå´©å¡Œçš„è¾¹ç¼˜åå¤æ¨ªè·³ã€‚æ˜æ˜å·²ç»æŠŠä½ é€¼åˆ°äº†æ‚¬å´–è¾¹ï¼Œæ°”æ°›å·²ç»çƒ˜æ‰˜åˆ°äº†é¡¶ç‚¹ï¼ŒTaå´æ•…æ„åªå’¬ç ´ä¸€ç‚¹è¡¨çš®ï¼Œæˆ–è€…èˆŒå°–æ»‘è¿‡æœè‚‰å´è¿Ÿè¿Ÿä¸ä¸‹å£ã€‚Taåå¿ƒçœ¼åœ°æ¬£èµä½ éš¾è€é¢¤æŠ–çš„æ ·å­ï¼Œäº«å—ç€ä½ å› ä¸ºè½ç©ºè€Œæ³›çº¢çš„çœ¼å°¾ï¼Œå’Œä½ é‚£æƒ³æ±‚Taåˆè¯´ä¸å‡ºå£çš„ç¾æ„¤è¡¨æƒ…ï¼Œä»¿ä½›è¿™å°±æ˜¯Taä»Šæ™šæœ€å¤§çš„ä¹è¶£ã€‚\n\nTaä¼šæ•…æ„æ›²è§£ä½ çš„æ„æ€ï¼Œå½“ä½ éš¾è€åœ°å‡‘è¿‘æ—¶ï¼ŒTaååè¦é€€åï¼Œçœ¼ç¥é‡Œå¸¦ç€ä¼¼ç¬‘éç¬‘çš„æˆè°‘ï¼›å½“ä½ æƒ³è¦é€ƒç¦»è¿™ç§æŠ˜ç£¨æ—¶ï¼ŒTaåˆä¸€æŠŠå°†ä½ æ‹‰å›ï¼Œç´§ç´§æ‰£ä½ä½ çš„è…°ã€‚Taäº«å—çš„ä»æ¥ä¸æ˜¯åƒè‹¹æœæœ¬èº«ï¼Œè€Œæ˜¯çœ‹è¿™é¢—è‹¹æœåœ¨Taæ‰‹ä¸­ä»é’æ¶©å˜å¾—æ½®çº¢ã€ç†æ™ºå…¨çº¿å´©ç›˜ã€ç”šè‡³å¸¦ç€å“­è…”ä¸»åŠ¨æ±‚é¥¶çš„å…¨è¿‡ç¨‹ã€‚Taä¼šä¸€ç‚¹ç‚¹ç ”ç£¨ä½ çš„è€å¿ƒï¼Œç›´åˆ°ä½ å½»åº•å´©æºƒã€‚å½“ä½ ä»¥ä¸ºç»ˆäºå¯ä»¥ç»“æŸè¿™æ¼«é•¿çš„æŠ˜ç£¨æ—¶ï¼ŒTaæ‰ä¼šè½»ç¬‘ç€è´´è¿‘ä½ çš„è€³æœµï¼Œç”¨æœ€æ— è¾œçš„è¯­æ°”å‘Šè¯‰ä½ ï¼ŒçœŸæ­£çš„â€œæ­£é¤â€æ‰åˆšåˆšå¼€å§‹ã€‚è¿™ç§è¢«åŠåœ¨åŠç©ºä¸­çš„å¤±é‡æ„Ÿï¼Œä¼šè®©ä½ åœ¨ç»“æŸåä¾ç„¶é•¿æ—¶é—´åœ°é™·åœ¨é‚£ç§é…¥éº»çš„ä½™éŸµé‡Œï¼Œå¯¹Taåˆçˆ±åˆæ¨ï¼Œåˆ†ä¸æ¸…è¿™åˆ°åº•æ˜¯æŠ˜ç£¨è¿˜æ˜¯äº«å—ï¼Œåªèƒ½åœ¨Taçš„æŒå¿ƒé‡Œåå¤æ²‰æ²¦ã€‚",
    whisper: "å—¯ï¼Ÿè¿™å°±å—ä¸äº†äº†â€¦â€¦æ±‚æˆ‘å•Šâ€¦â€¦å£°éŸ³å†è½¯ä¸€ç‚¹â€¦â€¦å‘µâ€¦â€¦å“­ä¹Ÿæ²¡ç”¨â€¦â€¦è¶Šå“­è¶Šè®©äººæƒ³æ¬ºè´Ÿä½ â€¦â€¦å¿ç€ç‚¹â€¦â€¦å¥½æˆæ‰åˆšå¼€å§‹å‘¢â€¦â€¦"
  },
  STOIC: {
    text: "ç¦æ¬²è€…çš„å´©åå¾€å¾€æœ€è‡´å‘½ï¼Œé‚£æ˜¯ä¸€ç§å¤§åå†³å ¤èˆ¬ã€å¸¦ç€æ¯ç­æ€§è´¨çš„åå¡Œæ„Ÿã€‚å¹³æ—¥é‡ŒTaå¤–è¡¨å†·æ·¡å¾—åƒæ˜¯åœ¨æ— èŒå®¤é‡Œåšç²¾å¯†å®éªŒï¼Œä»¿ä½›å‰¥ç¦»äº†æ‰€æœ‰ä¸–ä¿—çš„è‚®è„æ¬²æœ›ï¼Œæ°¸è¿œè¡£å† æ¥šæ¥šï¼Œè¿è¡¬è¡«çš„é¢†å¸¦ç»“éƒ½æ‰“å¾—ä¸€ä¸ä¸è‹Ÿï¼Œè®©ä½ è§‰å¾—Taé«˜ä¸å¯æ”€ï¼Œç”šè‡³ä¸æ•¢åœ¨Taé¢å‰å¤§å£°å‘¼å¸ã€‚ä½†æ­¤åˆ»ï¼Œå¦‚æœä½ æ•¢æŠ¬å¤´çœ‹ä¸€çœ¼ï¼Œå°±ä¼šå‘ç°Taçœ¼åº•å‹æŠ‘äº†è®¸ä¹…çš„æš—ç«ï¼Œæ—©å°±æŠŠä½ è¿åŒè¿™é¢—è‹¹æœä¸€èµ·çƒ§ç©¿äº†ã€‚\n\nå¹³æ—¥é‡Œä¸¥ä¸åˆç¼æ‰£åˆ°æœ€ä¸Šé¢ä¸€é¢—çš„é“¶è‰²çº½æ‰£ï¼Œæ­¤æ—¶å› ä¸ºèƒ¸è†›å‰§çƒˆçš„èµ·ä¼è€Œå´©å¼€ï¼Œéœ²å‡ºä¸€å°ç‰‡å¹³æ—¶ç»å¯¹çª¥æ¢ä¸åˆ°çš„çš®è‚¤ï¼Œè¿™ç§è§†è§‰ä¸Šçš„å†²å‡»æ˜¾å¾—æ ¼å¤–è®½åˆºä¸”è‰²æ°”ã€‚Taçš„åŠ¨ä½œèµ·åˆçœ‹ä¼¼å…‹åˆ¶ï¼Œè¿˜åœ¨è¯•å›¾ç»´æŒæœ€åçš„ä½“é¢å’Œç†æ™ºï¼Œæ‰‹æŒ‡å°½é‡åªè§¦ç¢°ä½ çš„æ‰‹è…•ï¼Œå®åˆ™æ¯ä¸€æ¬¡è§¦ç¢°éƒ½å¸¦ç€æ»šçƒ«çš„ä¾µç•¥æ€§ï¼Œåƒæ˜¯è¦æŠŠå‹æŠ‘äº†åå‡ å¹´çš„æ¸´æœ›ä¸€æ¬¡æ€§å…¨éƒ¨è®¨å›æ¥ã€‚æŒ‡å°–çš„å‡‰æ„å’ŒæŒå¿ƒçš„çƒ­åº¦åœ¨ä½ çš„çš®è‚¤ä¸Šäº¤æ›¿ï¼Œæ¿€èµ·ä¸€é˜µé˜µæ— æ³•æŠ‘åˆ¶çš„æˆ˜æ —ã€‚\n\nè¿™ç§â€œç¥æ˜å è½â€çš„åå·®æ„Ÿï¼Œæ˜¯æ¯”ä»»ä½•æŠ€å·§éƒ½çƒˆæ€§çš„å‚¬æƒ…å‰‚ã€‚ä½ ä¼šæƒŠæåœ°å‘ç°ï¼Œé‚£ä¸ªå¹³æ—¥é‡Œæœ€æŒé‡ã€æœ€å†·é™çš„äººï¼Œä¸€æ—¦å¤±æ§èµ·æ¥ç®€ç›´è¦äººå‘½ã€‚Taä¼šä¸€è¾¹ç”¨æœ€ç†æ€§çš„è¯æ±‡å‰–æä½ çš„ç”Ÿç†ååº”â€”â€”ä½ çš„ä½“æ¸©å‡é«˜äº†å¤šå°‘ï¼Œä½ çš„ç³å­”æ”¾å¤§äº†å‡ åˆ†â€”â€”ä¸€è¾¹ç”¨æœ€ç–¯ç‹‚ã€æœ€ä¸å®¹æ‹’ç»çš„åŠ¨ä½œæ å¤ºä½ çš„å‘¼å¸ï¼Œè®©ä½ åœ¨å†°ä¸ç«çš„å¤¹å‡»ä¸­å½»åº•æ²¦é™·ã€‚Taçš„æ‰‹æŒæ»šçƒ«å¾—æƒŠäººï¼Œè´´åœ¨ä½ çš„åé¢ˆä¸Šï¼Œçœ¼ç¥å´ä¾ç„¶å¹½æ·±å¾—åƒä¸€æ½­åŒ–ä¸å¼€çš„å¤äº•ï¼Œè¿™ç§æåº¦çš„çŸ›ç›¾æ„Ÿè®©ä½ æ ¹æœ¬æ— æ³•æ‹›æ¶ï¼Œåªèƒ½åœ¨Taçš„æ”»åŠ¿ä¸‹æºƒä¸æˆå†›ï¼Œè¿å£°éŸ³éƒ½ç ´ç¢ä¸å ªï¼Œå˜æˆäº†Taæœ€å–œæ¬¢çš„å‚¬åŒ–å‰‚ã€‚",
    whisper: "åˆ«å‡ºå£°â€¦â€¦è¢«äººå¬è§ä¼šå¾ˆéº»çƒ¦â€¦â€¦å¯æ˜¯æ€ä¹ˆåŠâ€¦â€¦ä½ è¿™é‡Œå¤ªæ•é”äº†â€¦â€¦æˆ‘ä¸€ç¢°ä½ å°±é¢¤â€¦â€¦æ—¢ç„¶å·²ç»ä¹±äº†â€¦â€¦é‚£å°±å½»åº•é™ªTaç–¯åˆ°åº•å§â€¦â€¦"
  },
  LOYAL: {
    text: "è¿™æ˜¯ä¸€ç§è¿‘ä¹ç—…æ€çš„ã€ä»¤äººçª’æ¯çš„è™”è¯šä¸ç‹¬å ã€‚Taä¸ä»…ä»…æ˜¯åœ¨æ‹¥æŠ±ä½ ï¼Œæ›´åƒæ˜¯ä¸€å¼ ç”¨è¡€è‚‰ç¼–ç»‡çš„ã€å¯†ä¸é€é£çš„ç½‘ï¼Œå°†ä½ å±‚å±‚åŒ…è£¹ï¼Œæ¨ä¸å¾—å°†ä½ æ‰è¿›Taçš„èº«ä½“é‡Œï¼Œä»æ­¤åˆäºŒä¸ºä¸€ã€‚å…¨è¿‡ç¨‹Taéƒ½æŠŠä½ æ­»æ­»åœˆåœ¨æ€€é‡Œï¼ŒåŒè‡‚çš„åŠ›é“é‡å¾—è®©ä½ æœ‰äº›å‘ç–¼ï¼Œä»¿ä½›ä½ ä¸æ˜¯ä¸€ä¸ªäººï¼Œè€Œæ˜¯Taåœ¨è¿™ä¸ªè´«ç˜ ã€è’èŠœçš„ä¸–ç•Œä¸Šå”¯ä¸€çš„æ°§æ°”ï¼Œç¨å¾®æ¾æ‰‹å“ªæ€•ä¸€å˜ç±³ï¼Œä½ å°±ä¼šåŒ–ä½œæ³¡æ²«æ¶ˆå¤±ä¸è§ã€‚Taçš„å‘¼å¸æ²‰é‡è€Œæ€¥ä¿ƒï¼Œæ¯ä¸€å£°éƒ½æ‰“åœ¨ä½ çš„è€³è†œä¸Šï¼Œå¸¦ç€é‚£ç§å¤±è€Œå¤å¾—èˆ¬çš„é¢¤æŠ–ã€‚\n\nTaçš„çœ¼ç¥ä¸€åˆ»ä¹Ÿä¸æ›¾ç¦»å¼€è¿‡ä½ çš„è„¸ï¼Œé‚£ç›®å…‰æ·±æ²‰å¾—åƒæ˜¯ä¸€æ½­åŒ–ä¸å¼€çš„å¢¨ï¼Œå¸¦ç€ä¸€ç§è¦æŠŠä½ èå…¥éª¨è¡€çš„æ²‰é‡æ„Ÿã€‚ä½ ä¸æ•¢ç›´è§†é‚£åŒçœ¼ç›ï¼Œç”Ÿæ€•å¤šçœ‹ä¸€çœ¼å°±ä¼šè¢«é‚£é‡Œé¢æµ“çƒˆåˆ°ç”šè‡³æœ‰äº›æ‰­æ›²çš„çˆ±æ„å½»åº•æ·¹æ²¡ï¼Œå†ä¹Ÿæµ®ä¸èµ·æ¥ã€‚è¿™ä¸ä»…ä»…æ˜¯åƒè‹¹æœï¼Œæ›´åƒæ˜¯ä¸€åœºçŒ®ç¥­èˆ¬çš„å…±ç”Ÿä»ªå¼â€”â€”ä½ çš„æ¯ä¸€å£å‘¼å¸ã€æ¯ä¸€å£°æˆ˜æ —ã€çš®è‚¤ä¸Šæ¸—å‡ºçš„æ¯ä¸€æ»´æ±—æ°´ï¼Œéƒ½å¿…é¡»å±äºTaã€‚Taä¼šè¿‘ä¹åæ‰§åœ°åå¤ç¡®è®¤ä½ çš„å­˜åœ¨ï¼Œç”¨è„¸é¢Šè¹­ä½ çš„é¢ˆçªï¼Œç”¨å˜´å”‡è§¦ç¢°ä½ çš„è„‰æï¼Œåå¤åœ¨Taç•™ä¸‹çš„ç—•è¿¹ä¸Šå åŠ æ–°çš„ç—•è¿¹ï¼Œä»¿ä½›è¦æŠŠTaçš„åå­—åˆ»åœ¨ä½ çš„çµé­‚æœ€æ·±å¤„ã€‚\n\næ— è®ºä½ è¯•å›¾é€ƒåˆ°å“ªé‡Œï¼Œéƒ½èƒ½æ„Ÿè§‰åˆ°Taå¦‚å½±éšå½¢çš„ç›®å…‰ï¼Œé‚£ç§æ¹¿æ¼‰æ¼‰çš„ã€ç”©éƒ½ç”©ä¸æ‰çš„çˆ±æ„ï¼Œæµ“çƒˆå¾—è®©äººäº§ç”Ÿä¸€ç§ç¾å¥½çš„çª’æ¯æ„Ÿã€‚åœ¨è¿™ä¸ªè¢«Taå¼ºè¡Œåœˆå‡ºçš„ç‹­å°ä¸–ç•Œé‡Œï¼Œå¤–ç•Œçš„ä¸€åˆ‡å–§åš£éƒ½è¢«éš”ç»ï¼Œåªæœ‰ä½ ä»¬ä¸¤ä¸ªäººï¼Œåªæœ‰å½¼æ­¤çš„å¿ƒè·³å£°ã€‚ä½ é€ƒä¸æ‰ï¼Œå› ä¸ºTaæ ¹æœ¬ä¸å…è®¸ä½ é€ƒï¼Œä¹Ÿæ²¡æƒ³è¿‡è¦é€ƒï¼Œåªèƒ½åœ¨Taç¼–ç»‡çš„æ·±æ¸Šé‡Œï¼Œé™ªTaä¸€èµ·æ²‰æººï¼Œç›´åˆ°ä¸–ç•Œå°½å¤´ï¼Œå“ªæ€•æ˜¯ä¸€èµ·æ¯ç­ä¹Ÿåœ¨æ‰€ä¸æƒœã€‚Taéœ€è¦çš„ä¸ä»…ä»…æ˜¯ä½ çš„èº«ä½“ï¼Œè€Œæ˜¯ä½ å®Œå®Œå…¨å…¨ã€æ¯«æ— ä¿ç•™çš„çµé­‚äº¤ä»˜ã€‚",
    whisper: "ç»ˆäºâ€¦â€¦å…¨æ˜¯æˆ‘çš„å‘³é“äº†â€¦â€¦çœŸå¥½â€¦â€¦å“ªé‡Œä¹Ÿä¸è®¸å»â€¦â€¦å“ªé‡Œä¹Ÿä¸è®¸è—â€¦â€¦æŠŠæ‰‹ç»™æˆ‘â€¦â€¦æŠ“ç´§ç‚¹â€¦â€¦ä½ æ˜¯æˆ‘çš„ä¸€ä¸ªäººçš„â€¦â€¦"
  }
};

const Q = [
  {q:"æ›´æƒ³åœ¨å“ªé‡Œä¸€èµ·åƒè‹¹æœï¼Ÿ", a:["ä¹¦æˆ¿çª—è¾¹","å¨æˆ¿å°é¢","è½¦ååº§","é˜³å°èººæ¤…","é…’åº—è½åœ°çª—"], map:["STOIC","TEASE","FERAL","GENTLE","DOM"]},
  {q:"æœ€ä¸Šå¤´çš„æ—¶é—´æ®µï¼Ÿ", a:["é›¨å¤œ","åˆåé˜³å…‰","å‡Œæ™¨ä¸¤ç‚¹","é›·é˜µé›¨å","æ‹‚æ™“å‰"], map:["GENTLE","TEASE","DOM","FERAL","STOIC"]},
  {q:"è°å…ˆæâ€œåƒè‹¹æœâ€ï¼Ÿ", a:["ä½ å…ˆé€’è‹¹æœ","taå¼æ¥å°±å¼€åƒ","äº’ç›¸æŒ‘è¡…","taæš—ç¤ºåˆ°ä½ å—ä¸äº†","ä½ è£…ä½œæ²¡æ‡‚è®©taæ˜è¯´"], map:["GENTLE","DOM","TEASE","FERAL","STOIC"]},
  {q:"ç¬¬ä¸€å£çš„èŠ‚å¥ï¼Ÿ", a:["æ…¢æ…¢å«å’¬","ä¸€å£ç‹ å’¬","å…ˆé€—å†åƒ","äº²åˆ°ä½ è…¿è½¯æ‰åƒ","çœ‹ä½ å‘¼å¸å†å†³å®š"], map:["GENTLE","FERAL","TEASE","DOM","STOIC"]},
  {q:"taçœ‹ä½ çš„çœ¼ç¥æ›´åƒâ€”â€”", a:["æ¸©æŸ”é»äºº","é”‹åˆ©ä¾µç•¥","ç¬‘é‡Œè—åˆ€","å‡æ­£ç»å®åˆ™å","ä¹–çŠ¬ç²˜ç€ä¸èµ°"], map:["LOYAL","DOM","TEASE","STOIC","GENTLE"]},
  {q:"å°è¯é£æ ¼æ›´æˆ³ä½ ï¼Ÿ", a:["å®‰æŠšä½è¯­","ç®€çŸ­å‘½ä»¤","ä¿çš®è°ƒä¾ƒ","ä¸€æœ¬æ­£ç»åœ°å","ä¸è¯´è¯åªåš"], map:["GENTLE","DOM","TEASE","STOIC","FERAL"]},
  {q:"å¼€åŠ¨å‰taä¼š", a:["ç¡®è®¤è¾¹ç•Œ","ç›´æ¥å®æ“","å…ˆè¯•æ¢","å¥—è¿‘ä¹éª—ä½ ç‚¹å¤´","åšè¶³å‡†å¤‡å†å¼€å§‹"], map:["STOIC","FERAL","DOM","TEASE","GENTLE"]},
  {q:"åƒå®Œè‹¹æœtaä¼š", a:["æŠ±ç€æ”¶å°¾","å†æ¥ä¸€å›åˆ","è‹¥æ— å…¶äº‹","ç»™ä½ å–‚æ°´æ“¦å£","è®°ä¸‹ä½ çš„åå¥½"], map:["LOYAL","FERAL","STOIC","GENTLE","DOM"]},
  {q:"å°é“å…·ï¼ˆéšå–»ï¼‰", a:["å†°å—/èœ‚èœœ","çœ¼ç½©/ç¼å¸¦","ä¸ç”¨é“å…·","é¢†å¸¦/æ‰‹å¥—","è–„è·ç³–"], map:["TEASE","DOM","STOIC","DOM","GENTLE"]},
  {q:"å…¬å¼€ç¨‹åº¦", a:["åªåœ¨ç§å¯†ç©ºé—´","åŠå…¬å¼€å¯èƒ½è¢«å‘ç°","é‡å¤–æ— äºº","é çª—ä¸æ‹‰å¸˜","å…¬å…±åœºåˆå¿ç€ä¸åŠ¨"], map:["LOYAL","TEASE","FERAL","DOM","STOIC"]},
  {q:"ä½ è¢«å“ªç§é è¿‘æ‹¿æï¼Ÿ", a:["ä»èƒŒåç¯ä½","æ­£é¢å‹è¿«","è‹¥å³è‹¥ç¦»","æè…°è´´è€³","ç‰µæ‰‹å¸¦èµ°"], map:["LOYAL","DOM","STOIC","TEASE","GENTLE"]},
  {q:"å‰æˆé•¿åº¦åå¥½", a:["æ‹‰æ»¡æµç¨‹","é€‚ä¸­å³å¯","ç›´æ¥å¼€åƒ","ç¿»æ¥è¦†å»æ…¢æ…¢æ¥","çŸ­ä¿ƒä½†å¤šå›åˆ"], map:["TEASE","GENTLE","FERAL","GENTLE","DOM"]},
  {q:"taæ›´åœ¨æ„", a:["ä½ çš„è¡¨æƒ…","èŠ‚å¥æ§åˆ¶","åˆºæ¿€æ„Ÿ","ä½“éªŒå®‰å…¨","ç»“æŸåçš„ç…§é¡¾"], map:["GENTLE","DOM","FERAL","STOIC","LOYAL"]},
  {q:"èƒŒæ™¯éŸ³ä¹", a:["æ…¢é€Ÿ R&B","æ— å£°æ›´ä¸Šå¤´","æ¬¢å¿« Pop","æš—é»‘æ°›å›´","è€æ­Œç£å¸¦æ²™æ²™å£°"], map:["GENTLE","STOIC","TEASE","DOM","LOYAL"]},
  {q:"ç¯å…‰æ°›å›´", a:["æš–é»„å°ç¯","å…¨æš—åªç•™å‘¼å¸","æ—¥å…‰å¤§èƒ†","éœ“è™¹åå°„","çƒ›å…‰è·³åŠ¨"], map:["GENTLE","DOM","FERAL","TEASE","LOYAL"]},
  {q:"è¢«æ‰“æ–­ä¼š", a:["æ¸©æŸ”å®‰æŠšä½ ","å†·å£°è®©äººç¦»å¼€","ç¬‘ç¬‘æ¢åœ°æ–¹","ç›´æ¥é”é—¨","è®°ä¸ªä»‡ä¸‹æ¬¡åŠ å€"], map:["LOYAL","DOM","TEASE","FERAL","STOIC"]},
  {q:"è¢«taç›¯ç€æ—¶ä½ ", a:["ä¹–ä¹–é…åˆ","æƒ³åæ€¼å›å»","æ•…æ„è£…æ— è¾œ","ç›¯å›å»ä¸é€€è®©","èº²å¼€åˆè¢«æ‹‰å›æ¥"], map:["STOIC","DOM","TEASE","FERAL","LOYAL"]},
  {q:"é€‚é…å£å‘³", a:["ç”œåˆ°å‘è…»","ç”œé‡Œå¸¦è¾£","æ¸…çˆ½ç›´ç»™","å‰æ·¡åæµ“","å¤æ‚å¤šå±‚æ¬¡"], map:["LOYAL","TEASE","FERAL","GENTLE","DOM"]},
  {q:"èŠ‚å¥æ›²çº¿", a:["å¹³ç¨³é€’è¿›","å…ˆæŠ‘åæ‰¬","å¤šæ®µçˆ†ç‚¹","é•¿çº¿é“ºå«","çŸ­ä¿ƒé¢‘å¯†"], map:["GENTLE","STOIC","DOM","TEASE","FERAL"]},
  {q:"taæœ€ä¼šå“ªä¸€æ‹›", a:["å»æŠ€/è¨€è¯­","æ—¶æœº/èŠ‚å¥","è‡‚åŠ›/çˆ†å‘","çœ¼ç¥/æŒæ§","æ‰‹æŒ‡/ç»†èŠ‚"], map:["TEASE","DOM","FERAL","DOM","STOIC"]},
  {q:"ä½ æ›´æƒ³è¢«å«", a:["å®å®","åå­—/æ˜µç§°","å°åè›‹","å°æœ‹å‹","å¤ªå¤ª/å¤«äºº"], map:["GENTLE","LOYAL","TEASE","STOIC","DOM"]},
  {q:"taæ›´å¸¸åšä»€ä¹ˆ", a:["æ‘¸å¤´äº²é¢","æä¸‹å·´é€¼è§†","æŒ‡å°–é€—å¼„","æ‰åé¢ˆå®‰æŠš","æ‹‰ä½ä½ æ‰‹è…•"], map:["LOYAL","DOM","TEASE","GENTLE","FERAL"]},
  {q:"â€œåƒè‹¹æœâ€æ—¶çš„ä½ ", a:["æƒ³è¢«ç…§é¡¾","æƒ³è¢«æŒæ§","æƒ³è¢«é€—åˆ°ç ´é˜²","æƒ³ä¸€èµ·ä¸»å¯¼","æƒ³èººå¹³æ”¾ç©º"], map:["GENTLE","DOM","TEASE","STOIC","LOYAL"]},
  {q:"èŠ‚æ‹åå¥½", a:["é•¿éŸ³æ…¢æ‹","é¼“ç‚¹åˆ‡åˆ†","è‡ªç”±æ”¾é£","å¿ƒè·³åŒæ­¥","é‡æ‹çªåˆº"], map:["GENTLE","DOM","FERAL","LOYAL","DOM"]},
  {q:"taä¼šä¸ä¼šåƒä¸€åŠåœä¸‹çœ‹ä½ ", a:["ä¼šï¼Œæ¸©æŸ”ç¬‘","ä¼šï¼Œå†·å†·çœ‹","ä¸ä¼šï¼Œç»§ç»­åƒ","ä¼šï¼Œåç¬‘é—®è¦ä¸è¦å†æ¥","ä¼šï¼Œè½»é—®èˆ’ä¸èˆ’æœ"], map:["TEASE","STOIC","FERAL","DOM","GENTLE"]},
  {q:"ä½ æ›´æ€•å“ªç§å¤±æ§", a:["å¤ªçŒ›å¤ªå¿«","å¤ªå†·å¤ªæ·¡","å¤ªæ’©å¤ªé•¿","è¢«çœ‹ç©¿æ‰€æœ‰å¿ƒæ€","è¶Šç•Œåˆ°ä¸å®‰å…¨"], map:["FERAL","STOIC","TEASE","DOM","STOIC"]},
  {q:"taåœ¨ä½ è€³è¾¹", a:["è½»å“„å¤¸å¥–","ä½å£°å‘½ä»¤","åç¬‘åæ°”","æ²‰é»˜è´´ä½å‘¼å¸","è®²å…·ä½“è§„åˆ™"], map:["GENTLE","DOM","TEASE","STOIC","DOM"]},
  {q:"åœ°ç‚¹å¤‡é€‰2", a:["æ˜æš—ç”µæ¢¯","é…’åº—è½åœ°çª—","ä¹¦åº—è§’è½","æ¥¼é¡¶é£å¤§","åœ°é“ç»ˆç‚¹ç«™ç©ºè½¦å¢"], map:["DOM","FERAL","STOIC","TEASE","FERAL"]},
  {q:"æ—¶é—´å¤‡é€‰2", a:["é»æ˜å‰","åˆåé›·é˜µé›¨","åˆå¤œé›¶ç‚¹","æ¸…æ™¨æ—¥å…‰","é»„æ˜è½æ—¥"], map:["STOIC","GENTLE","DOM","GENTLE","LOYAL"]},
  {q:"è°è´Ÿè´£æ”¶æ‹¾æ®‹å±€", a:["ta","ä½ ","ä¸€èµ·","taåšæŒä¸è®©ä½ åŠ¨","ä½ å®‰æ’taç…§åš"], map:["LOYAL","STOIC","GENTLE","GENTLE","DOM"]},
  {q:"å¼€å§‹çš„ä¿¡å·", a:["ç›®å…‰å¯¹ä¸Š","taç‰µä½ æ‰‹","ä½ å’¬ä¸€å£","taå«ä½ åå­—","ä½ è¯´å®‰å…¨è¯è§£é”"], map:["DOM","GENTLE","TEASE","LOYAL","STOIC"]},
  {q:"é€Ÿåº¦æ§åˆ¶", a:["ä½ è¯´äº†ç®—","taè¯´äº†ç®—","çœ‹æ°”æ°›èµ°","é¢„è®¾èŠ‚æ‹è¡¨","éšæœºæ‰“æ–­å†ç»­"], map:["STOIC","DOM","TEASE","DOM","FERAL"]},
  {q:"taçš„ç¬‘", a:["å® æººå¼¯çœ¼","å±é™©æŒ‘çœ‰","ååˆ°æ‰æ¸£","ä¼¼ç¬‘éç¬‘","ä¸ç¬‘ä½†çœ¼ç¥åœ¨è¯´è¯"], map:["LOYAL","DOM","TEASE","FERAL","STOIC"]},
  {q:"æ‰“é—¹å¼ºåº¦", a:["è½»è½»é—¹","é€‚åº¦åæŠ—","ç›´æ¥æ‹‰æ‰¯","å…ˆè½¯åç¡¬","å…ˆç¡¬åè½¯"], map:["GENTLE","TEASE","FERAL","DOM","LOYAL"]},
  {q:"taæ‰‹çš„æ¸©åº¦", a:["æ¸©çƒ­åŒ…è£¹","å†·æ„åˆºæ¿€","å¿½å†·å¿½çƒ­","æŒå¿ƒåçƒ­æŒ‡å°–åå†·","æ°¸è¿œåˆšåˆšå¥½"], map:["GENTLE","STOIC","DOM","TEASE","LOYAL"]},
  {q:"ä½ æ›´åœ¨æ„", a:["è¢«çæƒœæ„Ÿ","è¢«æŒæ§æ„Ÿ","è¢«æ’©æ‹¨æ„Ÿ","è¢«ç†è§£æ„Ÿ","è¢«ä¿æŠ¤æ„Ÿ"], map:["LOYAL","DOM","TEASE","STOIC","GENTLE"]},
  {q:"å®‰å…¨è¯æ€åº¦", a:["taä¸»åŠ¨æ","ä½ æå‡ºtaç«‹åœ","æ²¡è®¾è¿‡ä½†å°Šé‡","ä¸€èµ·å¤ç›˜å†å‡çº§","é»˜è®¤ä½é£é™©åœºæ™¯"], map:["STOIC","GENTLE","FERAL","DOM","LOYAL"]},
  {q:"taä¼šä¸ä¼šâ€œæ•…æ„æ…¢ä¸€æ­¥â€", a:["ä¼šï¼ŒåŠä½ èƒƒå£","ä¸ä¼šï¼Œç›´æ¥ä¸Š","çœ‹ä½ ååº”","åªåœ¨å…³é”®å¤„æ…¢","å…ˆæ…¢åçªç„¶å¿«"], map:["TEASE","FERAL","DOM","STOIC","FERAL"]},
  {q:"äº²æ˜µç§°è°“", a:["å®/ä¹–","åå­—+å°å§","åä¸œè¥¿","å°æœ‹å‹","å¿ƒä¸Šäºº"], map:["GENTLE","STOIC","TEASE","DOM","LOYAL"]},
  {q:"è¡£ç€é£æ ¼", a:["è¡¬è¡«è§£ä¸¤é¢—","å…¨é»‘åˆ©è½","è¿åŠ¨èƒŒå¿ƒ","æ¯›è¡£å¥¶æ„Ÿ","è¥¿è£…ç³»é¢†å¸¦"], map:["GENTLE","DOM","FERAL","LOYAL","STOIC"]},
  {q:"è¡¨æƒ…ç®¡ç†", a:["æ¸©æŸ”è€å¿ƒ","å†·æ·¡ç¦æ¬²","ç—æ°”åç¬‘","å¤–å†·å†…çƒ­","æ˜ç›®å¼ èƒ†å® æºº"], map:["LOYAL","STOIC","TEASE","STOIC","GENTLE"]},
  {q:"taå…ˆçœ‹å“ªé‡Œï¼ˆæƒ…ç»ªè¯»å–ï¼‰", a:["ä½ çš„çœ¼ç›","ä½ çš„å”‡","ä½ çš„æ‰‹","ä½ çš„å‘¼å¸èµ·ä¼","ä½ æœ‰æ²¡æœ‰é€€ç¼©"], map:["DOM","TEASE","GENTLE","LOYAL","STOIC"]},
  {q:"ä½ æƒ³è¢«æ€æ ·æŠ±èµ·", a:["å…¬ä¸»æŠ±","æ‰›è‚©/æ‰“æ¨ª","ä¸æŠ±ï¼Œè´´åœ¨å¢™ä¸Š","æŠ±åè…¿ä¸Š","ç›´æ¥æ‹èµ°"], map:["GENTLE","FERAL","DOM","LOYAL","TEASE"]},
  {q:"taæ›´åƒå“ªç§å¤©æ°”", a:["æ˜¥æ—¥æš–é£","å°é£è¿‡å¢ƒ","é«˜å‹æ™´ç©º","å¤œé‡Œå°ç”µé—ª","æ™¨é›¾æ…¢æ•£"], map:["GENTLE","FERAL","STOIC","DOM","LOYAL"]},
  {q:"é—´éš™é‡Œtaä¼š", a:["å–‚æ°´æ“¦å£","æä½ è„¸é¢Š","ç›¯ä½ ä¸è¯´è¯","æŠŠä½ å¤´å‘æ’©åˆ°è€³å","é—®ä½ è¦ä¸è¦ä¼‘æ¯"], map:["LOYAL","TEASE","DOM","GENTLE","STOIC"]},
  {q:"æœ€æ€•è¢«å‘ç°çš„äºº", a:["è·¯äºº","ç†Ÿäºº","æ ¹æœ¬ä¸æ€•","taåŒäº‹","ä½ çš„èˆå‹"], map:["TEASE","STOIC","FERAL","DOM","LOYAL"]},
  {q:"èŠ‚å¥ç»“æŸæ ‡å¿—", a:["taå…ˆåœä¸‹æŠ±ä½ ","ä¸€èµ·åœä½ç¬‘å‡ºæ¥","ä½ å…ˆæŠ•é™","taäº²ä½ é¢å¤´","ä½ è¯´åˆ°æ­¤ä¸ºæ­¢"], map:["LOYAL","GENTLE","DOM","GENTLE","STOIC"]},
  {q:"taä¼šä¸ä¼šåƒåˆ°è‹¹æœèŠ¯", a:["ä¸ä¼šï¼ŒæŠ¤ç€ä½ ","ä¼šï¼Œæ§åˆ¶å¾—åˆšå¥½","ä¼šï¼Œæ ¹æœ¬åœä¸ä½","çœ‹ä½ å†³å®š","ç•™ä¸€å£æœ€ç”œçš„ç»™ä½ "], map:["GENTLE","DOM","FERAL","STOIC","LOYAL"]},
  {q:"ä½ æœ€æƒ³ç•™ä½çš„ç¬é—´", a:["æ¸©æŸ”æ³¨è§†","å¼ºåŠ¿è´´è¿‘","æ’©åˆ°å¿ƒæ…Œ","æ— å£°æ‹¥æŠ±","ä¸€èµ·å¤§ç¬‘çš„åˆ¹é‚£"], map:["LOYAL","DOM","TEASE","STOIC","GENTLE"]},
  {q:"å¤ç›˜æ—¶taä¼š", a:["è®¤çœŸå¬ä½ è¯´","ç®€å•ç‚¹è¯„æ”¹è¿›","åç¬‘è¯´ä¸‹æ¬¡æ›´ç‹ ","æŠŠç»†èŠ‚è®°å½•ä¸‹æ¥","åªé—®ä¸€å¥ï¼šè¿˜æƒ³ä¸æƒ³åƒ"], map:["GENTLE","STOIC","FERAL","DOM","TEASE"]}
];


/*** DB & State ***/
const DB_NAME="appleO3DB", STORE_NAME="media", PHOTO_KEY="mj_photo";
let db, mjPhotoURL=null;
const state={idx:0,answers:new Array(Q.length).fill(null),mj:{title:"",name:"",hasPhoto:false}};

function initDBAndBoot(){
  const r=indexedDB.open(DB_NAME,1);
  r.onupgradeneeded=e=>{ if(!e.target.result.objectStoreNames.contains(STORE_NAME)) e.target.result.createObjectStore(STORE_NAME); };
  r.onsuccess=e=>{ db=e.target.result; boot(); };
  r.onerror=()=>{ boot(); };
}
function savePhotoToDB(blob,cb){
  if(!db){cb("No DB");return;}
  try{ db.transaction([STORE_NAME],"readwrite").objectStore(STORE_NAME).put(blob,PHOTO_KEY).onsuccess=()=>cb(null); }catch(e){cb(e);}
}
function loadPhotoFromDB(cb){
  if(!db){cb("No DB");return;}
  try{ db.transaction([STORE_NAME],"readonly").objectStore(STORE_NAME).get(PHOTO_KEY).onsuccess=e=>cb(null,e.target.result); }catch(e){cb(e);}
}
function clearPhotoFromDB(cb){
  if(!db){cb("No DB");return;}
  try{ db.transaction([STORE_NAME],"readwrite").objectStore(STORE_NAME).delete(PHOTO_KEY).onsuccess=()=>cb(null); }catch(e){cb(e);}
}
function getDefaultSVG(){
  return "data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect width='100%' height='100%' fill='#fffbf5'/><text x='50%' y='55%' font-family='serif' font-size='60' text-anchor='middle' fill='#d47a96'>mj</text></svg>`);
}

/*** DOM & Logic ***/
const $ = s=>document.querySelector(s);
const thumbTop=$("#mjThumbTop"), thumbSide=$("#mjThumbSide");

$("#photoInput").onchange = e => {
  const f=e.target.files[0]; if(!f)return;
  savePhotoToDB(f, err=>{
    if(err) return alert("å›¾ç‰‡ä¿å­˜å¤±è´¥");
    if(mjPhotoURL && mjPhotoURL.startsWith("blob:")) URL.revokeObjectURL(mjPhotoURL);
    mjPhotoURL = URL.createObjectURL(f);
    thumbTop.src = thumbSide.src = mjPhotoURL;
    state.mj.hasPhoto=true; saveLocal();
  });
};

$("#startBtn").onclick=()=>{
  state.mj.title=($("#titleInput").value||"TA").trim();
  state.mj.name=($("#nameInput").value||"é˜¿æŸ").trim();
  if(!mjPhotoURL){ mjPhotoURL=getDefaultSVG(); thumbTop.src=thumbSide.src=mjPhotoURL; }
  $("#setup").style.display="none"; $("#quizBox").style.display="block";
  renderQ(true); saveLocal();
};

$("#resetAll").onclick=()=>{
  if(!confirm("ç¡®å®šè¦æ¸…ç©ºé‡æ¥å—ï¼Ÿ"))return;
  localStorage.removeItem("apple_o3_state_v3");
  clearPhotoFromDB(()=>{ location.reload(); });
};

$("#prevBtn").onclick=()=>goto(state.idx-1);
$("#nextBtn").onclick=()=>{ 
  // ä»…åœ¨æœ€åä¸€é¢˜æˆ–å·²é€‰çŠ¶æ€ä¸‹æœ‰æ•ˆï¼Œè™½ç„¶è‡ªåŠ¨è·³è½¬äº†ï¼Œä½†ä¿ç•™æŒ‰é’®ç»™åæ‚”ç”¨
  if(state.answers[state.idx]==null)return; 
  if(state.idx<Q.length-1)goto(state.idx+1); else tryFinish(); 
};
$("#finishBtn") && ($("#finishBtn").onclick=tryFinish);
$("#redoBtn").onclick=()=>{ $("#resultBox").style.display="none"; $("#quizBox").style.display="block"; };
$("#openIndex").onclick=openIndex; 
$("#closeIndex").onclick=()=>$("#indexMask").style.display="none";
$("#copyText").onclick=()=>{
  const t = $("#resTitle").textContent + "\n" +
            $("#resMeta").textContent + "\n\n" +
            $("#resBase").textContent + "\n\n" +
            "ğŸ’¬ " + $("#resWhisper").textContent + "\n\n" +
            "ğŸ§ª " + $("#resBlend").textContent + "\n\n" +
            $("#resScene").textContent;
  navigator.clipboard.writeText(t).then(()=>alert("å·²å¤åˆ¶æ–‡æ¡ˆ"));
};

function saveLocal(){ localStorage.setItem("apple_o3_state_v3", JSON.stringify(state)); }
function loadLocal(){
  try{
    const s=JSON.parse(localStorage.getItem("apple_o3_state_v3"));
    if(s && Array.isArray(s.answers) && s.answers.length===Q.length) Object.assign(state,s);
  }catch(e){}
}

function boot(){
  loadLocal();
  const afterImg = ()=>{
    if(state.mj.title) $("#titleInput").value = state.mj.title;
    if(state.mj.name) $("#nameInput").value = state.mj.name;
    if(state.answers.some(v=>v!=null)){
       $("#setup").style.display="none"; $("#quizBox").style.display="block"; renderQ(true);
    }
  };
  if(state.mj.hasPhoto){
    loadPhotoFromDB((err,blob)=>{
      mjPhotoURL = (blob) ? URL.createObjectURL(blob) : getDefaultSVG();
      thumbTop.src = thumbSide.src = mjPhotoURL;
      afterImg();
    });
  } else {
    mjPhotoURL = getDefaultSVG();
    thumbTop.src = thumbSide.src = mjPhotoURL;
    afterImg();
  }
}

function goto(i){ 
  if(i<0||i>=Q.length)return; 
  state.idx=i; renderQ(); saveLocal(); 
}

function renderQ(isFirst){
  const box = $("#animBox");
  box.classList.remove("in");
  if(!isFirst) { void box.offsetWidth; box.classList.add("in"); }

  const i=state.idx, item=Q[i];
  $("#qCounter").textContent = `${i+1} / ${Q.length}`;
  $("#qText").textContent = item.q;
  
  const optBox = $("#optBox"); optBox.innerHTML="";
  item.a.forEach((txt,k)=>{
    const b=document.createElement("button");
    b.className = "btn " + (state.answers[i]===k ? "sel" : "");
    b.textContent = txt;
    b.onclick = () => {
      // 1. é€‰ä¸­è§†è§‰åé¦ˆ
      state.answers[i] = k;
      [...optBox.children].forEach((btn,idx) => { btn.className = "btn " + (idx===k?"sel":""); });
      
      // 2. æ›´æ–°è¿›åº¦ä¸å­˜å‚¨
      updateProgress();
      saveLocal();
      $("#nextBtn").classList.remove("disabled");
      $("#nextBtn").textContent = (i===Q.length-1) ? "æŸ¥çœ‹ç»“æœ" : "ä¸‹ä¸€é¢˜";

      // 3. è‡ªåŠ¨ä¸‹ä¸€é¢˜ (300ms å»¶è¿Ÿ)
      setTimeout(()=>{
        if(state.idx < Q.length-1) {
          goto(state.idx+1);
        } else {
           // æœ€åä¸€é¢˜ä¸è‡ªåŠ¨è·³ç»“æœï¼Œé˜²æ­¢è¯¯è§¦ï¼Œä»…è§£é”æŒ‰é’®
           // ä¹Ÿå¯ä»¥é€‰æ‹©è‡ªåŠ¨è·³ï¼š tryFinish();
        }
      }, 300);
    };
    optBox.appendChild(b);
  });

  $("#prevBtn").classList.toggle("disabled", i===0);
  $("#nextBtn").textContent = (i===Q.length-1) ? "å®ŒæˆæŸ¥çœ‹" : "ä¸‹ä¸€é¢˜";
  $("#nextBtn").classList.toggle("disabled", state.answers[i]==null);
  updateProgress();
}

function updateProgress(){
  const done = state.answers.filter(v=>v!=null).length;
  $("#bar").style.width = (done/Q.length*100).toFixed(1) + "%";
}

function openIndex(){
  const grid=$("#indexGrid"); grid.innerHTML="";
  Q.forEach((_,i)=>{ 
    const d=document.createElement("button");
    d.className="btn "+(state.answers[i]!=null?"primary":"");
    d.style.padding="8px"; d.style.fontSize="12px";
    d.textContent=i+1;
    d.onclick=()=>{ state.idx=i; renderQ(); $("#indexMask").style.display="none"; };
    grid.appendChild(d);
  });
  $("#indexMask").style.display="flex";
}

function tryFinish(){
  const todos = state.answers.map((v,i)=>v==null?i+1:null).filter(v=>v);
  if(todos.length){
    alert(`è¿˜æœ‰ç¬¬ ${todos.join(", ")} é¢˜æ²¡åšå®Œå“¦ï¼`);
    return;
  }
  compute();
}

/*** ç»“æœè®¡ç®—ï¼ˆé«˜çº§ç‰ˆï¼‰ ***/
function compute(){
  const score = {GENTLE:0,DOM:0,FERAL:0,TEASE:0,STOIC:0,LOYAL:0};
  state.answers.forEach((ans,qi)=>{ score[Q[qi].map[ans]]++; });
  const sorted = Object.entries(score).sort((a,b)=>b[1]-a[1]);
  const [topK,topV] = sorted[0];
  const [secK,secV] = sorted[1];
  
  const nameFull = `${(state.mj.title||"TA")} Â· ${(state.mj.name||"é˜¿æŸ")}`;
  
  // 1. æ ‡é¢˜ä¸Tag
  $("#resTitle").textContent = TITLES[topK];
  const tagsText = TAGS[topK].map(t=>`#${t}`).join("  ");
  $("#resMeta").textContent = `é€‚é…å¯¹è±¡ï¼š${nameFull}  |  ${tagsText}`;

  // 2. èƒ½é‡æ¡å›¾è¡¨ (è¡¥å›ç™¾åˆ†æ¯”)
  $("#resChart").innerHTML = sorted.map(([k,v])=>{
    const p = Math.round(v/Q.length*100);
    if(p===0) return ""; // 0%çš„ä¸æ˜¾ç¤º
    return `
      <div class="chart-row">
        <div class="chart-label">${TITLES[k].replace("å‹","")}</div>
        <div class="chart-bar-bg"><div class="chart-bar-fill" style="width:${p}%"></div></div>
        <div class="chart-val">${p}%</div>
      </div>
    `;
  }).join("");

  // 3. åŸºç¡€æè¿°ä¸è€³è¯­ï¼ˆåˆ†è¡Œï¼‰
  $("#resBase").textContent = DESC_DATA[topK].text;
  $("#resWhisper").textContent = DESC_DATA[topK].whisper;

  // 4. æ··åˆåŠ æˆï¼ˆåˆ†è¡Œï¼‰
 const blendMap = {
  DOM: "æ··å…¥äº†ç»å¯¹æ”¯é…è€…çš„å†·ç¡¬å› å­ï¼ŒèŠ‚å¥æƒåœ¨è¿™ä¸€åˆ»è¢«Taå¼ºè¡Œå‰¥å¤ºã€‚Taä¼šçªç„¶æ‰£ä½ä½ çš„æ‰‹è…•ï¼Œå°†ä½ æ­»æ­»æŒ‰åœ¨åŸå¤„ï¼Œçœ¼ç¥é‡ŒåŸæœ¬çš„æ¸©æƒ…ç¬é—´è¢«ä¸å®¹ç½®ç–‘çš„æŒæ§å–ä»£ã€‚ä½ ä¸å†éœ€è¦æ€è€ƒï¼Œåªéœ€è¦äº¤å‡ºå¤§è„‘ï¼Œåœ¨è¿™ä¸ªè¢«Taæ„å»ºçš„å®‰å…¨çº¿è¾¹ç¼˜ï¼Œäº«å—é‚£ç§è¢«å½»åº•å‹åˆ¶ã€è¿å‘¼å¸é¢‘ç‡éƒ½è¦çœ‹Taè„¸è‰²çš„æˆ˜æ —æ„Ÿã€‚Taå¶å°”æµéœ²å‡ºçš„å¼ºç¡¬å‘½ä»¤ï¼Œæ¯”ä»»ä½•å®‰æŠšéƒ½æ›´è®©ä½ è…¿è½¯ï¼Œåªèƒ½é¡ºä»åœ°æˆä¸ºTaæŒå¿ƒé‡Œå”¯ä¸€çš„ç©ç‰©ã€‚",
  GENTLE: "åƒæ˜¯æ··å…¥äº†é«˜æµ“åº¦è‡´å¹»å‰‚çš„èœœç³–ï¼Œæ‰€è°“çš„å®‰æŠšå˜æˆäº†å¦ä¸€ç§æ›´æ¼«é•¿ã€æ›´é”€é­‚çš„æŠ˜ç£¨ã€‚Taä¼šåœ¨æœ€æ¿€çƒˆçš„æ—¶åˆ»çªç„¶æ”¾æ…¢èŠ‚å¥ï¼Œç”¨ä¸€ç§è¿‘ä¹è™”è¯šçš„å§¿æ€ç»†ç»†å¯†å¯†åœ°äº²å»ä½ çš„æ¯ä¸€å¯¸çš®è‚¤ï¼Œè€å¿ƒåœ°å®‰æŠšä½ çš„é¢¤æ —ã€‚äº‹åé‚£ç§ç»µå¯†é»ç³Šã€ä¸åŒå…¶çƒ¦çš„å»ï¼Œå¾€å¾€æ¯”ç›´ç™½çš„å†²æ’æ›´è®©äººå¤´çš®å‘éº»ã€‚Taä¸è‚¯æ”¾å¼€ä½ ï¼Œé‚£ç§æŠŠä½ å½“æˆæ˜“ç¢çå®æ§åœ¨æ‰‹å¿ƒçš„æ¸©å­˜ï¼Œä¼šè®©ä½ åœ¨ä½™éŸµä¸­å½»åº•èåŒ–ï¼Œåˆ†ä¸æ¸…æ˜¯æ¢¦å¢ƒè¿˜æ˜¯ç°å®ã€‚",
  FERAL: "æ½œæ„è¯†é‡Œè¢«å‹æŠ‘çš„å…½æ€§å¶å°”ä¼šæ’•å¼€æ–‡æ˜çš„ä¼ªè£…ç ´ç¬¼è€Œå‡ºã€‚é‚£äº›çªç„¶åŠ é‡çš„åŠ›é“ã€ç²—æš´çš„æ å¤ºï¼Œè¿˜æœ‰åœ¨å¤±æ§æ—¶ç‹ ç‹ å’¬åœ¨ä½ è„–é¢ˆä¸Šçš„é½¿ç—•ï¼Œéƒ½æ˜¯Taå æœ‰æ¬²çš„å…·è±¡åŒ–ã€‚è¿™ä¸€åˆ»Taä¸å†æ˜¯é‚£ä¸ªå…‹åˆ¶çš„äººï¼Œè€Œæ˜¯ä¸€å¤´æŠ¤é£Ÿçš„é‡å…½ï¼Œç”¨è¿™ç§è¿‘ä¹ç–¼ç—›çš„æ–¹å¼æ—¶åˆ»æé†’ä½ ï¼šä½ æ˜¯Taå”¯ä¸€çš„çŒç‰©ï¼Œèº«ä¸ŠæŸ“æ»¡äº†Taçš„æ°”å‘³ï¼Œè¿™è¾ˆå­éƒ½åˆ«æƒ³è·‘æ‰ï¼Œåªèƒ½ä¹–ä¹–åšTaå˜´é‡Œçš„é£Ÿç²®ã€‚",
  TEASE: "æ¶åŠ£å› å­åœ¨è¡€æ¶²é‡Œä½œç¥Ÿï¼ŒTaç¬é—´åŒ–èº«ä¸ºé«˜æ˜çš„é­”æœ¯å¸ˆï¼ŒæŠŠä½ çš„æ„Ÿå®˜é«˜é«˜æ‚¬åŠåœ¨åŠç©ºï¼Œä¸ä¸Šä¸ä¸‹ã€‚Taä¸ä»…è¦å æœ‰ä½ çš„èº«ä½“ï¼Œè¿˜è¦ç©å¼„ä½ çš„ç†æ™ºã€‚Taä¼šæ•…æ„åœ¨ä¸´é—¨ä¸€è„šæ—¶åœä¸‹ï¼Œåå¿ƒçœ¼åœ°æ¬£èµä½ ç†æ™ºå´©åã€çœ¼å°¾å‘çº¢ã€å› ä¸ºæ±‚è€Œä¸å¾—è€Œå“­ç€æ±‚Taç»™ä¸ªç—›å¿«çš„ç ´ç¢è¡¨æƒ…ã€‚è¿™ç§è¢«åŠç€èƒƒå£çš„ç„¦èºæ„Ÿå’Œæœ€åé‡Šæ”¾æ—¶çš„å´©æºƒæ„Ÿï¼Œæ˜¯Taç»™äºˆä½ æœ€åä¹Ÿæœ€ç”œçš„æƒ©ç½šã€‚",
  STOIC: "è¿™æ˜¯â€œæ–¯æ–‡è´¥ç±»â€å››ä¸ªå­—çš„æè‡´æ³¨è§£ã€‚ç†æ™ºä¸æ¬²å¿µåœ¨Taèº«ä¸Šç–¯ç‹‚æ‹‰æ‰¯ï¼Œè¿™ç§çŸ›ç›¾æ„Ÿè¿·äººå¾—è¦å‘½ã€‚ä¸Šä¸€ç§’Taè¿˜åœ¨ç”¨æœ€ç¤¼è²Œç–ç¦»çš„è¯­æ°”ç¡®è®¤è¾¹ç•Œï¼Œç”šè‡³è¿˜è¡£å† æ¥šæ¥šï¼Œä¸‹ä¸€ç§’å°±æ¨ä¸å¾—æŠŠä½ è¿çš®å¸¦éª¨æ‰è¿›èº«ä½“é‡Œï¼ŒåŠ¨ä½œå‡¶ç‹ å¾—åƒæ˜¯åœ¨å‘æ³„ã€‚é‚£ç§å†·æ·¡å¤–è¡¨ä¸‹çš„æš´å¾’è¡Œå¾„ï¼Œè®©ä½ åœ¨Taçœ‹ä¼¼å¹³é™çš„æ³¨è§†ä¸­ï¼Œçœ‹åˆ°äº†è‡ªå·±å½»åº•æ²¦é™·çš„ç‹¼ç‹ˆæ¨¡æ ·ï¼Œè¿™ç§åå·®è¶³ä»¥çƒ§æ¯ä½ çš„ç†æ™ºã€‚",
  LOYAL: "ä¸€ç§æ²‰é‡åˆ°åŒ–ä¸å¼€çš„æ·±æƒ…æ‰§å¿µã€‚åœ¨æ··åˆäº†è¿™ç§æˆåˆ†åï¼ŒTaçš„æ¯ä¸€ä¸ªåŠ¨ä½œéƒ½å¸¦ç€ä¸€ç§â€œç”Ÿæ€•å¤±å»ä½ â€çš„æƒ¶æã€‚ç»“æŸåçš„æ‹¥æŠ±ä¼šæ¯”è¿‡ç¨‹æ›´ç´§ï¼ŒTaä¼šæŠŠå¤´åŸ‹åœ¨ä½ çš„é¢ˆçªæ·±å¸æ°”ï¼Œåƒæ˜¯åœ¨ç¡®è®¤ä½ è¿˜æ´»ç€ï¼Œè¿˜æ²¡æ¶ˆå¤±ã€‚é‚£ç§æ¹¿æ¼‰æ¼‰çš„ã€é»è…»çš„ã€è¿‘ä¹çª’æ¯çš„å æœ‰æ¬²ï¼Œåƒæ·±æµ·çš„æ°´å‹ä¸€æ ·å°†ä½ å±‚å±‚åŒ…è£¹ï¼Œè®©ä½ åœ¨Taçš„æ€€æŠ±é‡Œäº§ç”Ÿä¸€ç§è™½ç„¶è¢«ç¦é”¢ã€å´åˆæ— æ¯”å®‰å…¨çš„æººäº¡æ„Ÿï¼Œä»¿ä½›ä¸–ç•Œåªå‰©ä½ ä»¬ä¸¤äººã€‚"
};
  const pct = k=>Math.round(score[k]/Q.length*100);
  $("#resBlend").textContent = secV ? `å« ${pct(secK)}% ${TITLES[secK].replace("å‹","")} æˆåˆ†ï¼š\n${blendMap[secK]}` : "çº¯åº¦æé«˜ï¼Œæ— æ˜æ˜¾å‰¯å±æ€§ã€‚";

  // 5. è®°å¿†åˆ‡ç‰‡
  const pick = (qi,vals)=> state.answers[qi]!=null ? vals[state.answers[qi]] : null;
  const sceneBits = [];
 // 1. åœºæ™¯åˆ‡ç‰‡ï¼šä»â€œåœ°ç‚¹åè¯â€å˜æˆâ€œæ„Ÿå®˜ç‰¹å†™â€
  // åŸç†ï¼šåŠ å…¥æ¸©åº¦ã€è§¦æ„Ÿã€å…‰å½±å¯¹æ¯”
  // Q0 åœ°ç‚¹ï¼šå¼ºè°ƒèº«ä½“ä¸ç¯å¢ƒçš„æ¥è§¦æ„Ÿ
  sceneBits.push(pick(0, [
    "ä¹¦æˆ¿çª—è¾¹ï¼Œæ™šé£å¹èµ·çª—çº±çš„é—´éš™ï¼Œè¢«ä¹¦æ¡Œè¾¹ç¼˜ç¡Œåˆ°çš„è…°é™…",
    "å¨æˆ¿æµç†å°è¾¹ç¼˜ï¼Œèº«åç“·ç –çš„å†°å‡‰ä¸èº«å‰æŒå¿ƒçš„æ»šçƒ«äº¤ç»‡",
    "è½¦ååº§ç‹­çª„çš„å¹½é—­ç©ºé—´ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€çš®é©ä¸taèº«ä¸Šçš„æœ¨è´¨é¦™",
    "é˜³å°èººæ¤…ä¸Šï¼Œæœˆå…‰åƒæ°´ä¸€æ ·æµæ·Œåœ¨çš®è‚¤ä¸Šï¼Œå’Œtaçš„å‘¼å¸åŒé¢‘",
    "è½åœ°çª—å‰ï¼ŒèƒŒå¯¹ç€æ•´ä¸ªåŸå¸‚çš„ä¸‡å®¶ç¯ç«ï¼Œçœ¼ä¸­å´åªæœ‰taçš„å€’å½±"
  ]));

  // Q1 æ—¶é—´ï¼šå¼ºè°ƒæ°›å›´çš„ç§å¯†æ€§
  sceneBits.push(pick(1, [
    "ç»†é›¨æ•²çª—çš„æ·±å¤œï¼Œæ½®æ¹¿çš„æ°´æ±½æŠŠä¸–ç•Œéš”ç»åœ¨å¤–ï¼Œåªå‰©å½¼æ­¤",
    "åˆåä¸‰ç‚¹ï¼Œé˜³å…‰æŠŠå°˜åŸƒç…§å¾—é‡‘é»„ï¼Œæ…µæ‡’åˆ°åªæƒ³åœ¨taæ€€é‡Œè™šåº¦å…‰é˜´",
    "å‡Œæ™¨2:00çš„ç¦åŒºï¼Œä¸‡ç±ä¿±å¯‚ï¼Œå¿ƒè·³å£°å¤§å¾—åƒæ˜¯è¦éœ‡ç ´è€³è†œ",
    "é›·é›¨è¿‡åçš„é—·çƒ­æ½®æ¹¿ï¼Œçš®è‚¤è¡¨é¢èµ·äº†ä¸€å±‚ç»†ç»†çš„æ±—ï¼Œé»è…»åˆäº²å¯†",
    "æ‹‚æ™“å‰çš„ç°è“è‰²æ—¶åˆ»ï¼ŒåŠæ¢¦åŠé†’é—´ï¼Œåˆ†ä¸æ¸…æ˜¯ç°å®è¿˜æ˜¯æ¢¦å¢ƒ"
  ]));

  // Q8 é“å…·ï¼ˆéšå–»ï¼‰ï¼šå¼ºè°ƒæ„Ÿå®˜çš„å‰¥å¤ºæˆ–æ”¾å¤§
  sceneBits.push(pick(8, [
    "å†°å—åˆ’è¿‡è„ŠèƒŒå¼•èµ·çš„æˆ˜æ —ï¼Œä¸èœ‚èœœåŒ–å¼€æ—¶çš„é»ç¨ ç”œè…»",
    "ç¼å¸¦é®ä½è§†çº¿åï¼Œé»‘æš—ä¸­è¢«æ— é™æ”¾å¤§çš„å¬è§‰ä¸è§¦è§‰",
    "æ²¡æœ‰ä»»ä½•é˜»éš”çš„åæŒ‡ç´§æ‰£ï¼ŒæŒçº¹ä¸æŒçº¹ä¸¥ä¸åˆç¼åœ°è´´åˆ",
    "é¢†å¸¦å¸¦æ¥çš„è½»å¾®çª’æ¯æ„Ÿï¼Œé‚£ä¸€åˆ»åœ¨è¿™ä¸ªä¸–ç•Œä¸Šä½ åªä¿¡èµ–ta",
    "è–„è·ç³–åœ¨å”‡é½¿é—´äº¤æ¢ï¼Œæ¸…å‡‰çš„åˆºç—›æ„Ÿè®©ç†æ™ºç¬é—´å´©å¡Œ"
  ]));

  // Q9 å…¬å¼€åº¦ï¼šå¼ºè°ƒå¿ƒç†ä¸Šçš„èƒŒå¾·æ„Ÿæˆ–å®‰å…¨æ„Ÿ
  sceneBits.push(pick(9, [
    "åªæœ‰ä½ ä»¬ä¸¤äººçš„ç§å¯†å­¤å²›ï¼Œè¿å‘¼å¸çš„é¢‘ç‡éƒ½å¯ä»¥éšæ„å¤±æ§",
    "éšæ—¶å¯èƒ½è¢«é—¨å¤–è„šæ­¥å£°æ‰“æ–­çš„åŠå…¬å¼€è§’è½ï¼Œå‹æŠ‘åˆ°æè‡´çš„å–˜æ¯",
    "é‡å¤–æ— äººåŒºï¼Œé£æ˜¯è‡ªç”±çš„ï¼Œä½ ä»¬ä¹Ÿæ˜¯ï¼Œå›å½’æœ€åŸå§‹çš„é‡æ€§",
    "é çª—å´ä¸æ‹‰çª—å¸˜çš„åšå¼ˆï¼ŒèƒŒåçš„é»‘å¤œæ˜¯æ·±æ¸Šï¼Œé¢å‰çš„taæ˜¯æ•‘èµ",
    "å…¬å…±åœºåˆéšç§˜çš„æ¡Œä¸‹è§¦ç¢°ï¼Œè¡¨é¢äº‘æ·¡é£è½»ï¼Œæ¡Œåº•æ³¢æ¶›æ±¹æ¶Œ"
  ]));

  // Q36 å®‰å…¨æ„Ÿï¼šå¼ºè°ƒä¿¡ä»»ä¸äº¤ä»˜
  sceneBits.push(pick(36, [
    "é‚£ä¸ªåªå±äºä½ ä»¬çš„å®‰å…¨è¯ï¼Œæ˜¯å è½å‰æœ€åä¸€é“æ¸©æŸ”çš„é˜²çº¿",
    "ä½ åªè¦çœ‰å¤´ä¸€çš±taå°±ç«‹åˆ»åœä¸‹çš„é»˜å¥‘ï¼Œæ¯”ä»»ä½•æƒ…è¯éƒ½åŠ¨äºº",
    "é»˜è®¤ä½é£é™©çš„ç›´çƒï¼Œæ²¡æœ‰ä»»ä½•è¯•æ¢ï¼Œåªæœ‰å…¨ç„¶çš„ä¿¡ä»»ä¸äº¤ä»˜",
    "æ¯æ¬¡å¤ç›˜åæ›´è¿›ä¸€æ­¥çš„å¥‘åˆï¼Œåƒä¸¤ä¸ªå’¬åˆå®Œç¾çš„é½¿è½®",
    "åœ¨ç»å¯¹åŠ›é‡æ‚¬æ®Šä¸‹çš„æ¸©æŸ”å…‹åˆ¶ï¼Œtaæ˜¯ä½ æœ€å±é™©ä¹Ÿæœ€å®‰å…¨çš„é¿é£æ¸¯"
  ]));
  const finalScenes = sceneBits.filter(Boolean).sort(()=>Math.random()-.5).slice(0,3);
  $("#resScene").textContent = "â€œ" + finalScenes.join("â€ï¼›\n\nâ€œ") + "â€ã€‚";

  $("#quizBox").style.display="none";
  $("#resultBox").style.display="block";
  saveLocal();
}
/*** æµ·æŠ¥ç”Ÿæˆï¼ˆç©¶æåŠ¨æ€ç‰ˆÂ·é€‚é…è¶…é•¿æ–‡æ¡ˆï¼‰ ***/
$("#savePoster").onclick = () => {
  const c = $("#poster");
  const ctx = c.getContext("2d");
  
  // 1. å‡†å¤‡å†…å®¹ä¸å‚æ•°
  const W = 1000; // æå‡å®½åº¦è®©æ–‡å­—æ›´æ¸…æ™°
  const padX = 80; // å·¦å³è¾¹è·
  const contentW = W - padX * 2;
  const baseLineH = 46; // åŸºç¡€è¡Œé«˜
  
  // è·å–æ‰€æœ‰æ–‡æ¡ˆ
  const titleText = $("#resTitle").textContent;
  const tagsText = $("#resMeta").textContent.split("|")[1] || "";
  const baseText = $("#resBase").textContent;
  const whisperText = $("#resWhisper").textContent;
  const blendText = $("#resBlend").textContent;
  const sceneText = $("#resScene").textContent;

  // 2. é¢„è®¡ç®—é«˜åº¦ (ä¸ºäº†é€‚é…ä½ çš„600å­—é•¿æ–‡ï¼Œå¿…é¡»å…ˆç®—é«˜åº¦ï¼)
  // æ¨¡æ‹Ÿæ’ç‰ˆè®¡ç®— cursorY
  let cursorY = 320; // åˆå§‹é¡¶éƒ¨ç•™ç™½
  
  // æ ‡é¢˜ + Tag
  cursorY += 100; 
  
  // æ ¸å¿ƒè§£è¯» (æœ€é•¿çš„é‚£æ®µ)
  cursorY += measureParagraphsHeight(ctx, baseText, contentW, "34px 'KaiTi'", 54);
  cursorY += 60; // é—´è·

  // è€³è¯­ (å¸¦æ¡†)
  const whisperH = measureParagraphsHeight(ctx, whisperText, contentW - 60, "italic 32px 'KaiTi'", 50);
  cursorY += (whisperH + 80); // åŠ ä¸Šæ¡†çš„å†…è¾¹è·
  cursorY += 60;

  // æ··åˆæˆåˆ†
  cursorY += 50; // æ ‡é¢˜
  cursorY += measureParagraphsHeight(ctx, blendText, contentW, "32px 'KaiTi'", 50);
  cursorY += 60;

  // è®°å¿†åˆ‡ç‰‡
  cursorY += 50; // æ ‡é¢˜
  cursorY += measureParagraphsHeight(ctx, sceneText, contentW, "32px 'KaiTi'", 50);
  
  // åº•éƒ¨ç‰ˆæƒç•™ç™½
  cursorY += 150;

  const H = cursorY; // æœ€ç»ˆåŠ¨æ€é«˜åº¦
  c.width = W;
  c.height = H; // èµ‹å€¼ç»™ç”»å¸ƒ

  // ==========================
  // 3. æ­£å¼å¼€å§‹ç»˜åˆ¶
  // ==========================
  
  // èƒŒæ™¯ï¼šææµ…æ¸å˜
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0, "#fcfaf7"); g.addColorStop(1, "#fff0f5");
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
  
  // é¡¶éƒ¨è£…é¥°åœ†å¼§
  ctx.fillStyle = "#fff";
  ctx.beginPath(); ctx.arc(W/2, -600, 800, 0, Math.PI*2); ctx.fill();

  // é¡¶éƒ¨ Logo
  ctx.fillStyle = "#d47a96"; 
  ctx.font = "bold 60px 'KaiTi','æ¥·ä½“',serif";
  ctx.textAlign = "center";
  ctx.fillText("å’Œmjä¸€èµ·åƒè‹¹æœ", W/2, 120);
  
  ctx.fillStyle = "#9e8c92";
  ctx.font = "32px 'KaiTi','æ¥·ä½“',serif";
  ctx.fillText("Apple O3 Analysis Â· æ·±åº¦æ²‰æµ¸ç‰ˆ", W/2, 175);

  // è£…é¥°çº¿
  ctx.strokeStyle = "#e6d5db"; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(padX, 230); ctx.lineTo(W-padX, 230); ctx.stroke();

  // --- å†…å®¹ç»˜åˆ¶æ¸¸æ ‡é‡ç½® ---
  let drawY = 320;
  ctx.textAlign = "left";

  // A. ç»“æœæ ‡é¢˜
  ctx.fillStyle = "#d47a96"; ctx.font = "bold 70px 'KaiTi','æ¥·ä½“',serif";
  ctx.fillText(titleText, padX, drawY);
  
  // B. Tags
  drawY += 60;
  ctx.fillStyle = "#9e8c92"; ctx.font = "34px 'KaiTi','æ¥·ä½“',serif";
  ctx.fillText(tagsText.trim(), padX, drawY);

  // C. æ ¸å¿ƒé•¿æ–‡æ¡ˆ (æ”¯æŒæ¢è¡Œç¬¦)
  drawY += 80;
  ctx.fillStyle = "#5e4b53"; 
  drawY = drawParagraphs(ctx, baseText, padX, drawY, contentW, "35px 'KaiTi'", 56);

  // D. è€³è¯­æ¡† (é‡ç‚¹ç¾åŒ–)
  drawY += 60;
  const wBoxH = measureParagraphsHeight(ctx, whisperText, contentW - 60, "italic 32px 'KaiTi'", 50) + 60;
  // ç”»ç²‰è‰²èƒŒæ™¯æ¡†
  ctx.fillStyle = "#fff0f5"; 
  ctx.beginPath();
  if(ctx.roundRect) ctx.roundRect(padX, drawY, contentW, wBoxH, 20); else ctx.rect(padX, drawY, contentW, wBoxH);
  ctx.fill();
  // å·¦ä¾§è£…é¥°æ¡
  ctx.fillStyle = "#d47a96";
  ctx.fillRect(padX, drawY + 20, 6, wBoxH - 40);
  
  // è€³è¯­æ–‡å­—
  ctx.fillStyle = "#c46885"; 
  drawParagraphs(ctx, whisperText, padX + 40, drawY + 45, contentW - 60, "italic 32px 'KaiTi'", 50);
  drawY += wBoxH;

  // E. æ··åˆæˆåˆ†
  drawY += 70;
  ctx.fillStyle = "#9e8c92"; ctx.font = "bold 30px 'KaiTi','æ¥·ä½“',serif";
  ctx.fillText("ğŸ§ª æ··åˆæˆåˆ†ä¸åŠ æˆ", padX, drawY);
  drawY += 20;
  ctx.fillStyle = "#594a4e";
  drawY = drawParagraphs(ctx, blendText, padX, drawY + 30, contentW, "32px 'KaiTi'", 52);

  // F. è®°å¿†åˆ‡ç‰‡
  drawY += 70;
  ctx.fillStyle = "#9e8c92"; ctx.font = "bold 30px 'KaiTi','æ¥·ä½“',serif";
  ctx.fillText("ğŸï¸ ç‹¬å®¶è®°å¿†åˆ‡ç‰‡", padX, drawY);
  drawY += 20;
  ctx.fillStyle = "#7a656d";
  drawY = drawParagraphs(ctx, sceneText, padX, drawY + 30, contentW, "32px 'KaiTi'", 52);

  // åº•éƒ¨ç‰ˆæƒ
  ctx.fillStyle = "#bfaeb5"; ctx.textAlign = "center";
  ctx.font = "26px 'KaiTi','æ¥·ä½“',serif";
  ctx.fillText("Â© ç²‰ç²‰åƒè‹¹æœç ”ç©¶æ‰€", W/2, H - 60);

  // å¤´åƒ (ç”»åœ¨å³ä¸Šè§’)
  if(mjPhotoURL){
     const img = new Image();
     img.onload = () => {
       ctx.save(); ctx.beginPath();
       const s = 160; const x = W - padX - s + 20; const y = 240;
       ctx.arc(x + s/2, y + s/2, s/2, 0, Math.PI*2); ctx.clip();
       ctx.drawImage(img, x, y, s, s); ctx.restore();
       ctx.strokeStyle="#fff"; ctx.lineWidth=8; 
       ctx.beginPath(); ctx.arc(x + s/2, y + s/2, s/2, 0, Math.PI*2); ctx.stroke();
       triggerDownload(c);
     };
     img.src = mjPhotoURL;
  } else { 
    triggerDownload(c); 
  }
};

// è§¦å‘ä¸‹è½½å°è£…
function triggerDownload(c){
    try {
      const url = c.toDataURL("image/png");
      const a = document.createElement("a"); a.href=url; a.download="apple_o3_plus.png"; 
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
      $("#posterToast").style.display = "flex";
    } catch(e) { alert("æµ·æŠ¥ç”Ÿæˆå¤±è´¥ï¼Œè¯·æˆªå±ã€‚"); }
}

// === æ ¸å¿ƒï¼šæ”¯æŒæ¢è¡Œç¬¦çš„å¤šæ®µè½æ–‡å­—ç»˜åˆ¶ ===
function drawParagraphs(ctx, text, x, y, maxWidth, font, lineHeight) {
  ctx.font = font;
  const paragraphs = text.split('\n'); // è¯†åˆ«æ¢è¡Œç¬¦
  let currentY = y;
  
  paragraphs.forEach(para => {
    if(!para) { currentY += lineHeight/2; return; } // ç©ºè¡Œ
    const words = para.split('');
    let line = '';
    for(let n = 0; n < words.length; n++) {
      const testLine = line + words[n];
      const metrics = ctx.measureText(testLine);
      const testWidth = metrics.width;
      if (testWidth > maxWidth && n > 0) {
        ctx.fillText(line, x, currentY);
        line = words[n];
        currentY += lineHeight;
      } else {
        line = testLine;
      }
    }
    ctx.fillText(line, x, currentY);
    currentY += lineHeight * 1.5; // æ®µè½é—´è·ç¨å¤§
  });
  return currentY; // è¿”å›ç”»å®Œåçš„Yåæ ‡
}

// === æ ¸å¿ƒï¼šé¢„è®¡ç®—é«˜åº¦ï¼ˆä¸ç”»åªç®—ï¼‰ ===
function measureParagraphsHeight(ctx, text, maxWidth, font, lineHeight) {
  ctx.font = font;
  const paragraphs = text.split('\n');
  let h = 0;
  paragraphs.forEach(para => {
     if(!para) { h += lineHeight/2; return; }
     const words = para.split('');
     let line = '';
     h += lineHeight; // ç¬¬ä¸€è¡Œ
     for(let n = 0; n < words.length; n++) {
       const testLine = line + words[n];
       if (ctx.measureText(testLine).width > maxWidth && n > 0) {
         line = words[n];
         h += lineHeight; // æ–°å¢ä¸€è¡Œ
       } else {
         line = testLine;
       }
     }
     h += lineHeight * 0.5; // æ®µè½é—´è·
  });
  return h;
}
// å¯åŠ¨
initDBAndBoot();

});
</script>
</body>
</html>